!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([,function(e,t,n){(function(t){const r=n(3),i="undefined"==typeof window?t:window;i.loaders=i.loaders||{},e.exports=Object.assign(i.loaders,r)}).call(this,n(2))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t),n.d(t,"TerrainLoader",(function(){return c})),n.d(t,"TerrainWorkerLoader",(function(){return s})),n.d(t,"QuantizedMeshLoader",(function(){return m})),n.d(t,"QuantizedMeshWorkerLoader",(function(){return _})),n.d(t,"_NPYLoader",(function(){return M})),n.d(t,"_NPYWorkerLoader",(function(){return x}));class r{constructor(e=257){this.gridSize=e;const t=e-1;if(t&t-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=t*t*2-2,this.numParentTriangles=this.numTriangles-t*t,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let e=0;e<this.numTriangles;e++){let n=e+2,r=0,i=0,o=0,a=0,s=0,c=0;for(1&n?o=a=s=t:r=i=c=t;(n>>=1)>1;){const e=r+o>>1,t=i+a>>1;1&n?(o=r,a=i,r=s,i=c):(r=o,i=a,o=s,a=c),s=e,c=t}const u=4*e;this.coords[u+0]=r,this.coords[u+1]=i,this.coords[u+2]=o,this.coords[u+3]=a}}createTile(e){return new i(e,this)}}class i{constructor(e,t){const n=t.gridSize;if(e.length!==n*n)throw new Error(`Expected terrain data of length ${n*n} (${n} x ${n}), got ${e.length}.`);this.terrain=e,this.martini=t,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:t,coords:n,gridSize:r}=this.martini,{terrain:i,errors:o}=this;for(let a=e-1;a>=0;a--){const e=4*a,s=n[e+0],c=n[e+1],u=n[e+2],d=n[e+3],l=s+u>>1,f=c+d>>1,E=l+f-c,h=f+s-l,g=(i[c*r+s]+i[d*r+u])/2,y=f*r+l,p=Math.abs(g-i[y]);if(o[y]=Math.max(o[y],p),a<t){const e=(c+h>>1)*r+(s+E>>1),t=(d+h>>1)*r+(u+E>>1);o[y]=Math.max(o[y],o[e],o[t])}}}getMesh(e=0){const{gridSize:t,indices:n}=this.martini,{errors:r}=this;let i=0,o=0;const a=t-1;function s(a,c,u,d,l,f){const E=a+u>>1,h=c+d>>1;Math.abs(a-l)+Math.abs(c-f)>1&&r[h*t+E]>e?(s(l,f,a,c,E,h),s(u,d,l,f,E,h)):(n[c*t+a]=n[c*t+a]||++i,n[d*t+u]=n[d*t+u]||++i,n[f*t+l]=n[f*t+l]||++i,o++)}n.fill(0),s(0,0,a,a,a,0),s(a,a,0,0,0,a);const c=new Uint16Array(2*i),u=new Uint32Array(3*o);let d=0;function l(i,o,a,s,f,E){const h=i+a>>1,g=o+s>>1;if(Math.abs(i-f)+Math.abs(o-E)>1&&r[g*t+h]>e)l(f,E,i,o,h,g),l(a,s,f,E,h,g);else{const e=n[o*t+i]-1,r=n[s*t+a]-1,l=n[E*t+f]-1;c[2*e]=i,c[2*e+1]=o,c[2*r]=a,c[2*r+1]=s,c[2*l]=f,c[2*l+1]=E,u[d++]=e,u[d++]=r,u[d++]=l}}return l(0,0,a,a,a,0),l(a,a,0,0,0,a),{vertices:c,triangles:u}}}function o(e){if(!e||!e.POSITION)return null;let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;const s=e.POSITION.value,c=s&&s.length;if(!c)return null;for(let e=0;e<c;e+=3){const c=s[e],u=s[e+1],d=s[e+2];t=c<t?c:t,n=u<n?u:n,r=d<r?d:r,i=c>i?c:i,o=u>o?u:o,a=d>a?d:a}return[[t,n,r],[i,o,a]]}function a(e,t){if(null===e)return null;const{meshMaxError:n,bounds:i,elevationDecoder:a}=t,s=e.data,c=e.width,u=c+1,d=function(e,t,n){const{rScaler:r,bScaler:i,gScaler:o,offset:a}=n,s=t+1,c=new Float32Array(s*s);for(let n=0,s=0;s<t;s++)for(let u=0;u<t;u++,n++){const t=4*n,u=e[t+0],d=e[t+1],l=e[t+2];c[n+s]=u*r+d*o+l*i+a}for(let e=s*(s-1),t=0;t<s-1;t++,e++)c[e]=c[e-s];for(let e=s-1,t=0;t<s;t++,e+=s)c[e]=c[e-1];return c}(s,c,a),l=new r(u).createTile(d),{vertices:f,triangles:E}=l.getMesh(n),h=function(e,t,n,r){const i=n+1,o=e.length/2,a=new Float32Array(3*o),s=new Float32Array(2*o),[c,u,d,l]=r||[0,0,n,n],f=(d-c)/n,E=(l-u)/n;for(let r=0;r<o;r++){const o=e[2*r],u=e[2*r+1],d=u*i+o;a[3*r+0]=o*f+c,a[3*r+1]=-u*E+l,a[3*r+2]=t[d],s[2*r+0]=o/n,s[2*r+1]=u/n}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:s,size:2}}}(f,d,c,i);return{loaderData:{header:{}},header:{vertexCount:E.length,boundingBox:o(h)},mode:4,indices:{value:E,size:1},attributes:h}}const s={id:"terrain",name:"Terrain",version:"2.3.8",extensions:["png","pngraw"],mimeTypes:["image/png"],options:{terrain:{bounds:null,workerUrl:"https://unpkg.com/@loaders.gl/terrain@2.3.8/dist/terrain-loader.worker.js",meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0}}}},c={...s,parse:async function(e,t,n){return t.image=t.image||{},t.image.type="data",a(await n.parse(e,t,t.baseUri),t.terrain)}},u=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function d(e){return e>>1^-(1&e)}function l(e,t,n,r,i=!0){let o;if(o=2===r?new Uint16Array(e,t,n):new Uint32Array(e,t,n),!i)return o;let a=0;for(let e=0;e<o.length;++e){const t=o[e];o[e]=a-t,0===t&&++a}return o}function f(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const E=1,h=2,g=3,y=4,p={maxDecodingStep:y};function T(e,t){const n=Object.assign({},p,t),r=new DataView(e),{header:i,headerEndPosition:o}=function(e){let t=0;const n={};for(const[r,i]of u){const o=8===i?e.getFloat64:e.getFloat32;n[r]=o.call(e,t,!0),t+=i}return{header:n,headerEndPosition:t}}(r);if(n.maxDecodingStep<E)return{header:i};const{vertexData:a,vertexDataEndPosition:s}=function(e,t){let n=t;const r=e.getUint32(n,!0),i=new Uint16Array(3*r);n+=Uint32Array.BYTES_PER_ELEMENT;const o=Uint16Array.BYTES_PER_ELEMENT,a=r*o,s=n,c=s+a,u=c+a;let l=0,f=0,E=0;for(let t=0;t<r;t++)l+=d(e.getUint16(s+o*t,!0)),f+=d(e.getUint16(c+o*t,!0)),E+=d(e.getUint16(u+o*t,!0)),i[t]=l,i[t+r]=f,i[t+2*r]=E;return n+=3*a,{vertexData:i,vertexDataEndPosition:n}}(r,o);if(n.maxDecodingStep<h)return{header:i,vertexData:a};const{triangleIndices:c,triangleIndicesEndPosition:T}=function(e,t,n){let r=n;const i=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;r%i!=0&&(r+=i-r%i);const o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=3*o,s=l(e.buffer,r,a,i);return r+=a*i,{triangleIndicesEndPosition:r,triangleIndices:s}}(r,a,s);if(n.maxDecodingStep<g)return{header:i,vertexData:a,triangleIndices:c};const{westIndices:w,southIndices:b,eastIndices:_,northIndices:m,edgeIndicesEndPosition:S}=function(e,t,n){let r=n;const i=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=l(e.buffer,r,o,i,!1);r+=o*i;const s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const c=l(e.buffer,r,s,i,!1);r+=s*i;const u=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const d=l(e.buffer,r,u,i,!1);r+=u*i;const f=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const E=l(e.buffer,r,f,i,!1);return r+=f*i,{edgeIndicesEndPosition:r,westIndices:a,southIndices:c,eastIndices:d,northIndices:E}}(r,a,T);if(n.maxDecodingStep<y)return{header:i,vertexData:a,triangleIndices:c,westIndices:w,northIndices:m,eastIndices:_,southIndices:b};const{extensions:P}=function(e,t){const n={};if(e.byteLength<=t)return{extensions:n,extensionsEndPosition:t};let r=t;for(;r<e.byteLength;){const t=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT;const o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=new DataView(e.buffer,r,o);switch(t){case 1:n.vertexNormals=(i=a,new Uint8Array(i.buffer,i.byteOffset,i.byteLength));break;case 2:n.waterMask=f(a)}r+=o}var i;return{extensions:n,extensionsEndPosition:r}}(r,S);return{header:i,vertexData:a,triangleIndices:c,westIndices:w,northIndices:m,eastIndices:_,southIndices:b,extensions:P}}function w(e,t){if(!e)return null;const{bounds:n}=t,{header:r,vertexData:i,triangleIndices:a}=T(e,h),s=function(e,t,n){const{minHeight:r,maxHeight:i}=t,[o,a,s,c]=n||[0,0,1,1],u=s-o,d=c-a,l=i-r,f=e.length/3,E=new Float32Array(3*f),h=new Float32Array(2*f);for(let t=0;t<f;t++){const n=e[t]/32767,i=e[t+f]/32767,s=e[t+2*f]/32767;E[3*t+0]=n*u+o,E[3*t+1]=i*d+a,E[3*t+2]=s*l+r,h[2*t+0]=n,h[2*t+1]=i}return{POSITION:{value:E,size:3},TEXCOORD_0:{value:h,size:2}}}(i,r,n);return{loaderData:{header:{}},header:{vertexCount:a.length,boundingBox:o(s)},mode:4,indices:{value:a,size:1},attributes:s}}function b(e,t){return w(e,t["quantized-mesh"])}const _={id:"quantized-mesh",name:"Quantized Mesh",version:"2.3.8",extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{workerUrl:"https://unpkg.com/@loaders.gl/terrain@2.3.8/dist/quantized-mesh-loader.worker.js",bounds:[0,0,1,1]}}},m={..._,parseSync:b,parse:async(e,t)=>b(e,t)};const S=function(){const e=new Uint32Array([305419896]);return!(18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0])}(),P={u1:Uint8Array,i1:Int8Array,u2:Uint16Array,i2:Int16Array,u4:Uint32Array,i4:Int32Array,f4:Float32Array,f8:Float64Array};function A(e,t){if(!e)return null;const n=new DataView(e),{header:r,headerEndOffset:i}=function(e){const t=e.getUint8(6);let n,r=8;t>=2?(n=e.getUint32(8,!0),r+=4):(n=e.getUint16(8,!0),r+=2);const i=new TextDecoder(t<=2?"latin1":"utf-8"),o=new Uint8Array(e.buffer,r,n),a=i.decode(o);r+=n;return{header:JSON.parse(a.replace(/'/g,'"').replace("False","false").replace("(","[").replace(/,*\),*/g,"]")),headerEndOffset:r}}(n),o=r.descr,a=P[o.slice(1,3)];if(!a)return console.warn("Decoding of npy dtype not implemented: "+o),null;const s=r.shape.reduce((e,t)=>e*t)*a.BYTES_PER_ELEMENT,c=new a(e.slice(i,i+s));return(">"===o[0]&&S||"<"===o[0]&&!S)&&console.warn("Data is wrong endianness, byte swapping not yet implemented."),{data:c,header:r}}const x={id:"npy",name:"NPY",version:"2.3.8",extensions:["npy"],mimeTypes:[],tests:[new Uint8Array([147,78,85,77,80,89]).buffer],options:{npy:{workerUrl:"https://unpkg.com/@loaders.gl/terrain@2.3.8/dist/npy-loader.worker.js"}}},M={...x,parseSync:A,parse:async(e,t)=>A(e)}}])}));