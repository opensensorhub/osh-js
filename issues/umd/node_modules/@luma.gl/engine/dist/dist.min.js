!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=46)}([function(e,t,r){"use strict";t.a={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},function(e,t,r){"use strict";var n=r(6),i=r(17);var s=r(9),a=r(8),o=r(24),u="8.3.2",c=Object(o.a)();var l=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(s.a)(this,e),this.storage=function(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(n),this.id=t,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return Object(a.a)(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function h(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));var s=e.width*r,a=e.height*r,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}var f={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function _(e){return"string"==typeof e?f[e.toUpperCase()]||f.WHITE:e}function E(e,t){if(!e)throw new Error(t||"Assertion failed")}var d=r(11);function T(){var e;if(c&&d.b.performance)e=d.b.performance.now();else if(d.a.hrtime){var t=d.a.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var A={debug:c&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},g={enabled:!0,level:0};function m(){}var R={},b={once:!0};function p(e){for(var t in e)for(var r in e[t])return r||"untitled";return"empty"}var N=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;Object(s.a)(this,e),this.id=t,this.VERSION=u,this._startTs=T(),this._deltaTs=T(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new l("__probe-".concat(this.id,"__"),g),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),i=!0,s=!1,a=void 0;try{for(var o,u=function(){var r=o.value;"function"==typeof e[r]&&(t.find(function(e){return r===e})||(e[r]=e[r].bind(e)))},c=n[Symbol.iterator]();!(i=(o=c.next()).done);i=!0)u()}catch(e){s=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw a}}}(this),Object.seal(this)}return Object(a.a)(e,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((T()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((T()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"assert",value:function(e,t){E(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,A.warn,arguments,b)}},{key:"error",value:function(e){return this._getLogFunction(0,e,A.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,A.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,A.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){return this._getLogFunction(e,t,A.debug||A.info,arguments,b)}},{key:"table",value:function(e,t,r){return t?this._getLogFunction(e,t,console.table||m,r&&[r],{tag:p(t)}):m}},{key:"image",value:function(e){var t=e.logLevel,n=e.priority,s=e.image,a=e.message,o=void 0===a?"":a,u=e.scale,l=void 0===u?1:u;return this._shouldLog(t||n)?c?function(e){var t=e.image,r=e.message,n=void 0===r?"":r,s=e.scale,a=void 0===s?1:s;if("string"==typeof t){var o=new Image;return o.onload=function(){var e,t=h(o,n,a);(e=console).log.apply(e,Object(i.a)(t))},o.src=t,m}var u=t.nodeName||"";if("img"===u.toLowerCase()){var c;return(c=console).log.apply(c,Object(i.a)(h(t,n,a))),m}if("canvas"===u.toLowerCase()){var l=new Image;return l.onload=function(){var e;return(e=console).log.apply(e,Object(i.a)(h(l,n,a)))},l.src=t.toDataURL(),m}return m}({image:s,message:o,scale:l}):function(e){var t=e.image,n=(e.message,e.scale),i=void 0===n?1:n,s=null;try{s=r(51)}catch(e){}if(s)return function(){return s(t,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then(function(e){return console.log(e)})};return m}({image:s,message:o,scale:l}):m}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,t))}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||m)}},{key:"group",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=(r=I({logLevel:e,message:t,opts:r})).collapsed;return r.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}},{key:"groupCollapsed",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||m)}},{key:"withGroup",value:function(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=O(e)}},{key:"_getLogFunction",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(e)){var a;s=I({logLevel:e,message:t,args:n,opts:s}),E(r=r||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=T();var o=s.tag||s.message;if(s.once){if(R[o])return m;R[o]=T()}return t=function(e,t,r){if("string"==typeof t){var n=r.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=Math.max(t-e.length,0);return"".concat(" ".repeat(r)).concat(e)}((o=r.total)<10?"".concat(o.toFixed(2),"ms"):o<100?"".concat(o.toFixed(1),"ms"):o<1e3?"".concat(o.toFixed(0),"ms"):"".concat((o/1e3).toFixed(2),"s")):"";t=r.time?"".concat(e,": ").concat(n,"  ").concat(t):"".concat(e,": ").concat(t),i=t,s=r.color,a=r.background,c||"string"!=typeof i||(s&&(s=_(s),i="[".concat(s,"m").concat(i,"[39m")),a&&(s=_(a),i="[".concat(a+10,"m").concat(i,"[49m"))),t=i}var i,s,a;var o;return t}(this.id,s.message,s),(a=r).bind.apply(a,[console,t].concat(Object(i.a)(s.args)))}return m}},{key:"level",set:function(e){this.setLevel(e)},get:function(){return this.getLevel()}},{key:"priority",set:function(e){this.level=e},get:function(){return this.level}}]),e}();function O(e){if(!e)return 0;var t;switch(Object(n.a)(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return E(Number.isFinite(t)&&t>=0),t}function I(e){var t=e.logLevel,r=e.message;e.logLevel=O(t);for(var i=e.args?Array.from(e.args):[];i.length&&i.shift()!==r;);switch(e.args=i,Object(n.a)(t)){case"string":case"function":void 0!==r&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var s=Object(n.a)(e.message);return E("string"===s||"object"===s),Object.assign(e,e.opts)}function S(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function F(e){for(const t in e)return!1;return!0}function L(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}function y(e){const t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}N.VERSION=u;function C(e){return Boolean(e&&Number.isFinite(e._version))}function M(e){return Boolean(e&&2===e._version)}r.d(t,"g",function(){return v}),r.d(t,"a",function(){return S}),r.d(t,"b",function(){return L}),r.d(t,"d",function(){return F}),r.d(t,"c",function(){return y}),r.d(t,"e",function(){return C}),r.d(t,"f",function(){return M});const v=new N({id:"luma.gl"})},function(e,t,r){"use strict";r.d(t,"a",function(){return n}),r.d(t,"c",function(){return i}),r.d(t,"d",function(){return s}),r.d(t,"b",function(){return a});r(6),r(26),r(17),r(12),Math.PI,Math.PI;var n={};function i(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===t?n.precision||4:t;return e=function(e){return Math.round(e/n.EPSILON)*n.EPSILON}(e),"".concat(parseFloat(e.toPrecision(r)))}function s(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function a(e,t,r){var i=n.EPSILON;r&&(n.EPSILON=r);try{if(e===t)return!0;if(s(e)&&s(t)){if(e.length!==t.length)return!1;for(var o=0;o<e.length;++o)if(!a(e[o],t[o]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):!(!Number.isFinite(e)||!Number.isFinite(t))&&Math.abs(e-t)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{n.EPSILON=i}}n.EPSILON=1e-12,n.debug=!1,n.precision=4,n.printTypes=!1,n.printDegrees=!1,n.printRowMajor=!0},function(e,t,r){e.exports=r(48)},,,function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)})(e)}r.d(t,"a",function(){return i})},function(e,t,r){"use strict";r.d(t,"a",function(){return n});r(2);function n(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.d(t,"a",function(){return i})},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"a",function(){return n})},,function(e,t,r){"use strict";(function(e,n){r.d(t,"b",function(){return a}),r.d(t,"a",function(){return o});var i=r(6),s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":Object(i.a)(n))&&n},a=s.window||s.self||s.global,o=s.process||{};console}).call(this,r(18),r(16))},function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}r.d(t,"a",function(){return n})},function(e,t,r){"use strict";r.d(t,"c",function(){return s}),r.d(t,"e",function(){return l}),r.d(t,"a",function(){return f}),r.d(t,"b",function(){return _}),r.d(t,"d",function(){return d});var n=r(0),i=r(1);const s={[n.a.BLEND]:!1,[n.a.BLEND_COLOR]:new Float32Array([0,0,0,0]),[n.a.BLEND_EQUATION_RGB]:n.a.FUNC_ADD,[n.a.BLEND_EQUATION_ALPHA]:n.a.FUNC_ADD,[n.a.BLEND_SRC_RGB]:n.a.ONE,[n.a.BLEND_DST_RGB]:n.a.ZERO,[n.a.BLEND_SRC_ALPHA]:n.a.ONE,[n.a.BLEND_DST_ALPHA]:n.a.ZERO,[n.a.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[n.a.COLOR_WRITEMASK]:[!0,!0,!0,!0],[n.a.CULL_FACE]:!1,[n.a.CULL_FACE_MODE]:n.a.BACK,[n.a.DEPTH_TEST]:!1,[n.a.DEPTH_CLEAR_VALUE]:1,[n.a.DEPTH_FUNC]:n.a.LESS,[n.a.DEPTH_RANGE]:new Float32Array([0,1]),[n.a.DEPTH_WRITEMASK]:!0,[n.a.DITHER]:!0,[n.a.FRAMEBUFFER_BINDING]:null,[n.a.FRONT_FACE]:n.a.CCW,[n.a.GENERATE_MIPMAP_HINT]:n.a.DONT_CARE,[n.a.LINE_WIDTH]:1,[n.a.POLYGON_OFFSET_FILL]:!1,[n.a.POLYGON_OFFSET_FACTOR]:0,[n.a.POLYGON_OFFSET_UNITS]:0,[n.a.SAMPLE_COVERAGE_VALUE]:1,[n.a.SAMPLE_COVERAGE_INVERT]:!1,[n.a.SCISSOR_TEST]:!1,[n.a.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[n.a.STENCIL_TEST]:!1,[n.a.STENCIL_CLEAR_VALUE]:0,[n.a.STENCIL_WRITEMASK]:4294967295,[n.a.STENCIL_BACK_WRITEMASK]:4294967295,[n.a.STENCIL_FUNC]:n.a.ALWAYS,[n.a.STENCIL_REF]:0,[n.a.STENCIL_VALUE_MASK]:4294967295,[n.a.STENCIL_BACK_FUNC]:n.a.ALWAYS,[n.a.STENCIL_BACK_REF]:0,[n.a.STENCIL_BACK_VALUE_MASK]:4294967295,[n.a.STENCIL_FAIL]:n.a.KEEP,[n.a.STENCIL_PASS_DEPTH_FAIL]:n.a.KEEP,[n.a.STENCIL_PASS_DEPTH_PASS]:n.a.KEEP,[n.a.STENCIL_BACK_FAIL]:n.a.KEEP,[n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:n.a.KEEP,[n.a.STENCIL_BACK_PASS_DEPTH_PASS]:n.a.KEEP,[n.a.VIEWPORT]:[0,0,1024,1024],[n.a.PACK_ALIGNMENT]:4,[n.a.UNPACK_ALIGNMENT]:4,[n.a.UNPACK_FLIP_Y_WEBGL]:!1,[n.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[n.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:n.a.BROWSER_DEFAULT_WEBGL,[n.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:n.a.DONT_CARE,[n.a.READ_FRAMEBUFFER_BINDING]:null,[n.a.RASTERIZER_DISCARD]:!1,[n.a.PACK_ROW_LENGTH]:0,[n.a.PACK_SKIP_PIXELS]:0,[n.a.PACK_SKIP_ROWS]:0,[n.a.UNPACK_ROW_LENGTH]:0,[n.a.UNPACK_IMAGE_HEIGHT]:0,[n.a.UNPACK_SKIP_PIXELS]:0,[n.a.UNPACK_SKIP_ROWS]:0,[n.a.UNPACK_SKIP_IMAGES]:0},a=(e,t,r)=>t?e.enable(r):e.disable(r),o=(e,t,r)=>e.hint(r,t),u=(e,t,r)=>e.pixelStorei(r,t);function c(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const l={[n.a.BLEND]:a,[n.a.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[n.a.BLEND_EQUATION_RGB]:"blendEquation",[n.a.BLEND_EQUATION_ALPHA]:"blendEquation",[n.a.BLEND_SRC_RGB]:"blendFunc",[n.a.BLEND_DST_RGB]:"blendFunc",[n.a.BLEND_SRC_ALPHA]:"blendFunc",[n.a.BLEND_DST_ALPHA]:"blendFunc",[n.a.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[n.a.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[n.a.CULL_FACE]:a,[n.a.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[n.a.DEPTH_TEST]:a,[n.a.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[n.a.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[n.a.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[n.a.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[n.a.DITHER]:a,[n.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:o,[n.a.FRAMEBUFFER_BINDING]:(e,t)=>{const r=Object(i.f)(e)?n.a.DRAW_FRAMEBUFFER:n.a.FRAMEBUFFER;return e.bindFramebuffer(r,t)},[n.a.FRONT_FACE]:(e,t)=>e.frontFace(t),[n.a.GENERATE_MIPMAP_HINT]:o,[n.a.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[n.a.POLYGON_OFFSET_FILL]:a,[n.a.POLYGON_OFFSET_FACTOR]:"polygonOffset",[n.a.POLYGON_OFFSET_UNITS]:"polygonOffset",[n.a.RASTERIZER_DISCARD]:a,[n.a.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[n.a.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[n.a.SCISSOR_TEST]:a,[n.a.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[n.a.STENCIL_TEST]:a,[n.a.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[n.a.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(n.a.FRONT,t),[n.a.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(n.a.BACK,t),[n.a.STENCIL_FUNC]:"stencilFuncFront",[n.a.STENCIL_REF]:"stencilFuncFront",[n.a.STENCIL_VALUE_MASK]:"stencilFuncFront",[n.a.STENCIL_BACK_FUNC]:"stencilFuncBack",[n.a.STENCIL_BACK_REF]:"stencilFuncBack",[n.a.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[n.a.STENCIL_FAIL]:"stencilOpFront",[n.a.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[n.a.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[n.a.STENCIL_BACK_FAIL]:"stencilOpBack",[n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[n.a.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[n.a.VIEWPORT]:(e,t)=>e.viewport(...t),[n.a.PACK_ALIGNMENT]:u,[n.a.UNPACK_ALIGNMENT]:u,[n.a.UNPACK_FLIP_Y_WEBGL]:u,[n.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:u,[n.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:u,[n.a.PACK_ROW_LENGTH]:u,[n.a.PACK_SKIP_PIXELS]:u,[n.a.PACK_SKIP_ROWS]:u,[n.a.READ_FRAMEBUFFER_BINDING]:(e,t)=>e.bindFramebuffer(n.a.READ_FRAMEBUFFER,t),[n.a.UNPACK_ROW_LENGTH]:u,[n.a.UNPACK_IMAGE_HEIGHT]:u,[n.a.UNPACK_SKIP_PIXELS]:u,[n.a.UNPACK_SKIP_ROWS]:u,[n.a.UNPACK_SKIP_IMAGES]:u,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(n.a.FRAMEBUFFER,r)},blend:(e,t)=>t?e.enable(n.a.BLEND):e.disable(n.a.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=c(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=c(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(n.a.CULL_FACE):e.disable(n.a.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(n.a.DEPTH_TEST):e.disable(n.a.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(n.a.DITHER):e.disable(n.a.DITHER),derivativeHint:(e,t)=>{e.hint(n.a.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(n.a.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(n.a.POLYGON_OFFSET_FILL):e.disable(n.a.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(n.a.SCISSOR_TEST):e.disable(n.a.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(n.a.STENCIL_TEST):e.disable(n.a.STENCIL_TEST),stencilMask:(e,t)=>{t=c(t)?t:[t,t];const[r,i]=t;e.stencilMaskSeparate(n.a.FRONT,r),e.stencilMaskSeparate(n.a.BACK,i)},stencilFunc:(e,t)=>{t=c(t)&&3===t.length?[...t,...t]:t;const[r,i,s,a,o,u]=t;e.stencilFuncSeparate(n.a.FRONT,r,i,s),e.stencilFuncSeparate(n.a.BACK,a,o,u)},stencilOp:(e,t)=>{t=c(t)&&3===t.length?[...t,...t]:t;const[r,i,s,a,o,u]=t;e.stencilOpSeparate(n.a.FRONT,r,i,s),e.stencilOpSeparate(n.a.BACK,a,o,u)},viewport:(e,t)=>e.viewport(...t)};function h(e,t,r){return void 0!==t[e]?t[e]:r[e]}const f={blendEquation:(e,t,r)=>e.blendEquationSeparate(h(n.a.BLEND_EQUATION_RGB,t,r),h(n.a.BLEND_EQUATION_ALPHA,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(h(n.a.BLEND_SRC_RGB,t,r),h(n.a.BLEND_DST_RGB,t,r),h(n.a.BLEND_SRC_ALPHA,t,r),h(n.a.BLEND_DST_ALPHA,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(h(n.a.POLYGON_OFFSET_FACTOR,t,r),h(n.a.POLYGON_OFFSET_UNITS,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(h(n.a.SAMPLE_COVERAGE_VALUE,t,r),h(n.a.SAMPLE_COVERAGE_INVERT,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(n.a.FRONT,h(n.a.STENCIL_FUNC,t,r),h(n.a.STENCIL_REF,t,r),h(n.a.STENCIL_VALUE_MASK,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(n.a.BACK,h(n.a.STENCIL_BACK_FUNC,t,r),h(n.a.STENCIL_BACK_REF,t,r),h(n.a.STENCIL_BACK_VALUE_MASK,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(n.a.FRONT,h(n.a.STENCIL_FAIL,t,r),h(n.a.STENCIL_PASS_DEPTH_FAIL,t,r),h(n.a.STENCIL_PASS_DEPTH_PASS,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(n.a.BACK,h(n.a.STENCIL_BACK_FAIL,t,r),h(n.a.STENCIL_BACK_PASS_DEPTH_FAIL,t,r),h(n.a.STENCIL_BACK_PASS_DEPTH_PASS,t,r))},_={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),bindFramebuffer:(e,t,r)=>{switch(t){case n.a.FRAMEBUFFER:return e({[n.a.DRAW_FRAMEBUFFER_BINDING]:r,[n.a.READ_FRAMEBUFFER_BINDING]:r});case n.a.DRAW_FRAMEBUFFER:return e({[n.a.DRAW_FRAMEBUFFER_BINDING]:r});case n.a.READ_FRAMEBUFFER:return e({[n.a.READ_FRAMEBUFFER_BINDING]:r});default:return null}},blendColor:(e,t,r,i,s)=>e({[n.a.BLEND_COLOR]:new Float32Array([t,r,i,s])}),blendEquation:(e,t)=>e({[n.a.BLEND_EQUATION_RGB]:t,[n.a.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,r)=>e({[n.a.BLEND_EQUATION_RGB]:t,[n.a.BLEND_EQUATION_ALPHA]:r}),blendFunc:(e,t,r)=>e({[n.a.BLEND_SRC_RGB]:t,[n.a.BLEND_DST_RGB]:r,[n.a.BLEND_SRC_ALPHA]:t,[n.a.BLEND_DST_ALPHA]:r}),blendFuncSeparate:(e,t,r,i,s)=>e({[n.a.BLEND_SRC_RGB]:t,[n.a.BLEND_DST_RGB]:r,[n.a.BLEND_SRC_ALPHA]:i,[n.a.BLEND_DST_ALPHA]:s}),clearColor:(e,t,r,i,s)=>e({[n.a.COLOR_CLEAR_VALUE]:new Float32Array([t,r,i,s])}),clearDepth:(e,t)=>e({[n.a.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[n.a.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,r,i,s)=>e({[n.a.COLOR_WRITEMASK]:[t,r,i,s]}),cullFace:(e,t)=>e({[n.a.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[n.a.DEPTH_FUNC]:t}),depthRange:(e,t,r)=>e({[n.a.DEPTH_RANGE]:new Float32Array([t,r])}),depthMask:(e,t)=>e({[n.a.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[n.a.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[n.a.LINE_WIDTH]:t}),polygonOffset:(e,t,r)=>e({[n.a.POLYGON_OFFSET_FACTOR]:t,[n.a.POLYGON_OFFSET_UNITS]:r}),sampleCoverage:(e,t,r)=>e({[n.a.SAMPLE_COVERAGE_VALUE]:t,[n.a.SAMPLE_COVERAGE_INVERT]:r}),scissor:(e,t,r,i,s)=>e({[n.a.SCISSOR_BOX]:new Int32Array([t,r,i,s])}),stencilMask:(e,t)=>e({[n.a.STENCIL_WRITEMASK]:t,[n.a.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,r)=>e({[t===n.a.FRONT?n.a.STENCIL_WRITEMASK:n.a.STENCIL_BACK_WRITEMASK]:r}),stencilFunc:(e,t,r,i)=>e({[n.a.STENCIL_FUNC]:t,[n.a.STENCIL_REF]:r,[n.a.STENCIL_VALUE_MASK]:i,[n.a.STENCIL_BACK_FUNC]:t,[n.a.STENCIL_BACK_REF]:r,[n.a.STENCIL_BACK_VALUE_MASK]:i}),stencilFuncSeparate:(e,t,r,i,s)=>e({[t===n.a.FRONT?n.a.STENCIL_FUNC:n.a.STENCIL_BACK_FUNC]:r,[t===n.a.FRONT?n.a.STENCIL_REF:n.a.STENCIL_BACK_REF]:i,[t===n.a.FRONT?n.a.STENCIL_VALUE_MASK:n.a.STENCIL_BACK_VALUE_MASK]:s}),stencilOp:(e,t,r,i)=>e({[n.a.STENCIL_FAIL]:t,[n.a.STENCIL_PASS_DEPTH_FAIL]:r,[n.a.STENCIL_PASS_DEPTH_PASS]:i,[n.a.STENCIL_BACK_FAIL]:t,[n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:r,[n.a.STENCIL_BACK_PASS_DEPTH_PASS]:i}),stencilOpSeparate:(e,t,r,i,s)=>e({[t===n.a.FRONT?n.a.STENCIL_FAIL:n.a.STENCIL_BACK_FAIL]:r,[t===n.a.FRONT?n.a.STENCIL_PASS_DEPTH_FAIL:n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:i,[t===n.a.FRONT?n.a.STENCIL_PASS_DEPTH_PASS:n.a.STENCIL_BACK_PASS_DEPTH_PASS]:s}),viewport:(e,t,r,i,s)=>e({[n.a.VIEWPORT]:[t,r,i,s]})},E=(e,t)=>e.isEnabled(t),d={[n.a.BLEND]:E,[n.a.CULL_FACE]:E,[n.a.DEPTH_TEST]:E,[n.a.DITHER]:E,[n.a.POLYGON_OFFSET_FILL]:E,[n.a.SAMPLE_ALPHA_TO_COVERAGE]:E,[n.a.SAMPLE_COVERAGE]:E,[n.a.SCISSOR_TEST]:E,[n.a.STENCIL_TEST]:E,[n.a.RASTERIZER_DISCARD]:E}},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return c}),r.d(t,"c",function(){return l}),r.d(t,"b",function(){return h});var n=r(13),i=r(15),s=r(1);function a(e,t){const r=e[t].bind(e);e[t]=function(...t){const n=t[0];return n in e.state.cache||(e.state.cache[n]=r(...t)),e.state.enable?e.state.cache[n]:r(...t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function o(e,t,r){const n=e[t].bind(e);e[t]=function(...t){const{valueChanged:i,oldValue:s}=r(e.state._updateCache,...t);return i&&n(...t),s},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}class u{constructor(e,{copyState:t=!1,log:r=(()=>{})}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?Object(i.a)(e):Object.assign({},n.c),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Object(s.a)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Object(i.c)(this.gl,e,this.cache),this.stateStack.pop()}_updateCache(e){let t,r=!1;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const i in e){Object(s.a)(void 0!==i);const a=e[i],o=this.cache[i];Object(s.b)(a,o)||(r=!0,t=o,!n||i in n||(n[i]=o),this.cache[i]=a)}return{valueChanged:r,oldValue:t}}}function c(t,{enable:r=!0,copyState:i}={}){if(Object(s.a)(void 0!==i),!t.state){const s=void 0!==e?e:window;s.polyfillContext&&s.polyfillContext(t),t.state=new u(t,{copyState:i,enable:r}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}(t);for(const e in n.b){o(t,e,n.b[e])}a(t,"getParameter"),a(t,"isEnabled")}return t.state.enable=r,t}function l(e){e.state||c(e,{copyState:!1}),e.state.push()}function h(e){Object(s.a)(e.state),e.state.pop()}}).call(this,r(18))},function(e,t,r){"use strict";r.d(t,"c",function(){return a}),r.d(t,"a",function(){return o}),r.d(t,"b",function(){return u}),r.d(t,"d",function(){return c});var n=r(13),i=r(14),s=r(1);function a(e,t){if(Object(s.a)(Object(s.e)(e),"setParameters requires a WebGL context"),Object(s.d)(t))return;const r={};for(const i in t){const s=Number(i),a=n.e[i];a&&("string"==typeof a?r[a]=!0:a(e,t[i],s))}const i=e.state&&e.state.cache;if(i)for(const s in r){(0,n.a[s])(e,t,i)}}function o(e,t){if("number"==typeof(t=t||n.c)){const r=t,i=n.d[r];return i?i(e,r):e.getParameter(r)}const r=Array.isArray(t)?t:Object.keys(t),i={};for(const t of r){const r=n.d[t];i[t]=r?r(e,Number(t)):e.getParameter(Number(t))}return i}function u(e){a(e,n.c)}function c(e,t,r){if(Object(s.d)(t))return r(e);const{nocatch:n=!0}=t;let o;if(Object(i.c)(e),a(e,t),n)o=r(e),Object(i.b)(e);else try{o=r(e)}finally{Object(i.b)(e)}return o}},function(e,t){var r,n,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&_())}function _(){if(!l){var e=o(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function E(e,t){this.fun=e,this.array=t}function d(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new E(e,t)),1!==c.length||l||o(_)},E.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r.d(t,"a",function(){return n})},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r.d(t,"a",function(){return n})},function(e,t,r){"use strict";var n=r(0),i=r(1);const s=e=>Object(i.f)(e)?void 0:0,a={[n.a.READ_BUFFER]:e=>Object(i.f)(e)?void 0:n.a.COLOR_ATTACHMENT0,35723:e=>Object(i.f)(e)?void 0:4352,[n.a.RASTERIZER_DISCARD]:s,[n.a.SAMPLES]:s,36795:(e,t)=>{const r=Object(i.f)(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?t(r.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const r=e.getExtension("WEBGL_debug_renderer_info");return t(r&&r.UNMASKED_VENDOR_WEBGL||n.a.VENDOR)},37446:(e,t)=>{const r=e.getExtension("WEBGL_debug_renderer_info");return t(r&&r.UNMASKED_RENDERER_WEBGL||n.a.RENDERER)},34047:(e,t)=>{const r=e.luma.extensions.EXT_texture_filter_anisotropic;return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[n.a.MAX_3D_TEXTURE_SIZE]:s,[n.a.MAX_ARRAY_TEXTURE_LAYERS]:s,[n.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:s,[n.a.MAX_COLOR_ATTACHMENTS]:(e,t)=>{if(!Object(i.f)(e)){const r=e.getExtension("WEBGL_draw_buffers");return r?t(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[n.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:s,[n.a.MAX_COMBINED_UNIFORM_BLOCKS]:s,[n.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:s,[n.a.MAX_DRAW_BUFFERS]:e=>{if(!Object(i.f)(e)){const t=e.getExtension("WEBGL_draw_buffers");return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[n.a.MAX_ELEMENT_INDEX]:e=>e.getExtension("OES_element_index")?2147483647:65535,[n.a.MAX_ELEMENTS_INDICES]:e=>e.getExtension("OES_element_index")?16777216:65535,[n.a.MAX_ELEMENTS_VERTICES]:e=>16777216,[n.a.MAX_FRAGMENT_INPUT_COMPONENTS]:s,[n.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:s,[n.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:s,[n.a.MAX_SAMPLES]:s,[n.a.MAX_SERVER_WAIT_TIMEOUT]:s,[n.a.MAX_TEXTURE_LOD_BIAS]:s,[n.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:s,[n.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:s,[n.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:s,[n.a.MAX_UNIFORM_BLOCK_SIZE]:s,[n.a.MAX_UNIFORM_BUFFER_BINDINGS]:s,[n.a.MAX_VARYING_COMPONENTS]:s,[n.a.MAX_VERTEX_OUTPUT_COMPONENTS]:s,[n.a.MAX_VERTEX_UNIFORM_BLOCKS]:s,[n.a.MAX_VERTEX_UNIFORM_COMPONENTS]:s,[n.a.MIN_PROGRAM_TEXEL_OFFSET]:s,[n.a.MAX_PROGRAM_TEXEL_OFFSET]:s,[n.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:s};r.d(t,"b",function(){return o}),r.d(t,"a",function(){return u});const o={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Object(i.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},ANGLE_instanced_arrays:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Object(i.a)(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Object(i.a)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Object(i.a)(!1)},deleteQuery:()=>{Object(i.a)(!1)},beginQuery:()=>{Object(i.a)(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},u={readBuffer:(e,t,r)=>{Object(i.f)(e)&&t(r)},getVertexAttrib:(e,t,r,s)=>{const{webgl2:a,ext:o}=function(e,t){return{webgl2:Object(i.f)(e),ext:e.getExtension(t)}}(e,"ANGLE_instanced_arrays");let u;switch(s){case n.a.VERTEX_ATTRIB_ARRAY_INTEGER:u=!!a&&void 0;break;case n.a.VERTEX_ATTRIB_ARRAY_DIVISOR:u=a||o?void 0:0}return void 0!==u?u:t(r,s)},getProgramParameter:(e,t,r,s)=>{if(!Object(i.f)(e))switch(s){case n.a.TRANSFORM_FEEDBACK_BUFFER_MODE:return n.a.SEPARATE_ATTRIBS;case n.a.TRANSFORM_FEEDBACK_VARYINGS:case n.a.ACTIVE_UNIFORM_BLOCKS:return 0}return t(r,s)},getInternalformatParameter:(e,t,r,s,a)=>{if(!Object(i.f)(e))switch(a){case n.a.SAMPLES:return new Int32Array([0])}return e.getInternalformatParameter(r,s,a)},getTexParameter(e,t,r,i){switch(i){case n.a.TEXTURE_MAX_ANISOTROPY_EXT:const{extensions:t}=e.luma,r=t.EXT_texture_filter_anisotropic;i=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||n.a.TEXTURE_MAX_ANISOTROPY_EXT}return t(r,i)},getParameter:function(e,t,r){const n=a[r],i="function"==typeof n?n(e,t,r):n;return void 0!==i?i:t(r)},hint:(e,t,r,n)=>t(r,n)}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";(function(e){function n(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if(void 0!==e&&e.hrtime){var r=e.hrtime();t=1e3*r[0]+r[1]/1e6}else t=Date.now();return t}r.d(t,"a",function(){return n})}).call(this,r(16))},,function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return s});var n=r(6),i=r(25);function s(){return!("object"===(void 0===e?"undefined":Object(n.a)(e))&&"[object process]"===String(e)&&!e.browser)||Object(i.a)()}}).call(this,r(16))},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return i});var n=r(6);function i(t){if("undefined"!=typeof window&&"object"===Object(n.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===Object(n.a)(e.versions)&&Boolean(e.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":Object(n.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=t||r;return!!(i&&i.indexOf("Electron")>=0)}}).call(this,r(16))},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(19);function i(e,t,r){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var s=new(Function.bind.apply(e,i));return r&&Object(n.a)(s,r.prototype),s}).apply(null,arguments)}},,function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?e.exports=n=function(e){return r(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},n(t)}e.exports=n},function(e,t,r){"use strict";(function(e){var n=r(21);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){if("undefined"!=typeof window&&"object"===(0,i.default)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===(0,i.default)(e.versions)&&Boolean(e.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":(0,i.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=t||r;if(n&&n.indexOf("Electron")>=0)return!0;return!1};var i=n(r(28))}).call(this,r(16))},,function(e,t,r){"use strict";(function(e){var t=r(36),n=r(1),i=r(20);function s(e,{extension:t,target:r,target2:s}){const a=i.b[t];Object(n.a)(a);const{meta:o={}}=a,{suffix:u=""}=o,c=e.getExtension(t);for(const t of Object.keys(a)){const n=`${t}${u}`;let i=null;"meta"===t||"function"==typeof e[t]||(c&&"function"==typeof c[n]?i=(...e)=>c[n](...e):"function"==typeof a[t]&&(i=a[t].bind(r))),i&&(r[t]=i,s[t]=i)}}(void 0!==e?e:window).polyfillContext=function(e){return e.luma=e.luma||{},e.luma.polyfilled||(Object(t.a)(e),function(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const r of t)e.luma[r]=e.getExtension(r)}(e),function(e,t){for(const r of Object.getOwnPropertyNames(t))"overrides"!==r&&s(e,{extension:r,target:e.luma,target2:e})}(e,i.b),function(e,{target:t,target2:r}){Object.keys(i.a).forEach(n=>{if("function"==typeof i.a[n]){const s=e[n]?e[n].bind(e):()=>{},a=i.a[n].bind(null,e,s);t[n]=a,r[n]=a}})}(e,{target:e.luma,target2:e}),e.luma.polyfilled=!0),e}}).call(this,r(18))},function(e,t,r){"use strict";(function(e,n){var i=r(21);Object.defineProperty(t,"__esModule",{value:!0}),t.console=t.process=t.document=t.global=t.window=t.self=void 0;var s=i(r(28)),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":(0,s.default)(n))&&n},o=a.self||a.window||a.global;t.self=o;var u=a.window||a.self||a.global;t.window=u;var c=a.global||a.self||a.window;t.global=c;var l=a.document||{};t.document=l;var h=a.process||{};t.process=h;var f=console;t.console=f}).call(this,r(18),r(16))},function(e,t,r){"use strict";(function(e){var n=r(21);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,t.isBrowserMainThread=function(){return a()&&"undefined"!=typeof document};var i=n(r(28)),s=n(r(29));function a(){return!("object"===(void 0===e?"undefined":(0,i.default)(e))&&"[object process]"===String(e)&&!e.browser)||(0,s.default)()}}).call(this,r(16))},function(e,t,r){"use strict";(function(e){var n=r(2),i=r(35);r.d(t,"a",function(){return i.a});var s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e};(s.global||s.self||s.window).mathgl={config:n.a}}).call(this,r(18))},function(e,t,r){"use strict";var n=r(9),i=r(8),s=r(19);function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Object(s.a)(e,t)}var o=r(6);function u(e,t){return!t||"object"!==Object(o.a)(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=r(26);function h(e){var t="function"==typeof Map?new Map:void 0;return(h=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Object(l.a)(e,arguments,c(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object(s.a)(n,e)})(e)}var f=r(2),_=r(12);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}var d=function(e){a(r,h(Array));var t=E(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}},{key:"to",value:function(e){return e===this?this:Object(f.d)(e)?this.toArray(e):this.toObject(e)}},{key:"toTarget",value:function(e){return e?this.to(e):this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(f.a)}},{key:"formatString",value:function(e){for(var t="",r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+Object(f.c)(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}},{key:"equals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(!Object(f.b)(this[t],e[t]))return!1;return!0}},{key:"exactEquals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}},{key:"negate",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}},{key:"lerp",value:function(e,t,r){void 0===r&&(r=t,t=e,e=this);for(var n=0;n<this.ELEMENTS;++n){var i=e[n];this[n]=i+r*(t[n]-i)}return this.check()}},{key:"min",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}},{key:"max",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}},{key:"clamp",value:function(e,t){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]+=s[a];return this.check()}},{key:"subtract",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]-=s[a];return this.check()}},{key:"scale",value:function(e){if(Array.isArray(e))return this.multiply(e);for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"sub",value:function(e){return this.subtract(e)}},{key:"setScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}},{key:"addScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}},{key:"subScalar",value:function(e){return this.addScalar(-e)}},{key:"multiplyScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"divideScalar",value:function(e){return this.scale(1/e)}},{key:"clampScalar",value:function(e,t){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}},{key:"multiplyByScalar",value:function(e){return this.scale(e)}},{key:"check",value:function(){if(f.a.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var e=this.length===this.ELEMENTS,t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}},{key:"ELEMENTS",get:function(){return Object(_.a)(!1),0}},{key:"RANK",get:function(){return Object(_.a)(!1),0}},{key:"elements",get:function(){return this}}]),r}(),T=r(7);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}var g=function(e){a(r,d);var t=A(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"copy",value:function(e){return Object(_.a)(!1),this}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var e=0,t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSquared(e))}},{key:"distanceSquared",value:function(e){for(var t=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-e[r];t+=n*n}return Object(T.a)(t)}},{key:"dot",value:function(e){for(var t=0,r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Object(T.a)(t)}},{key:"normalize",value:function(){var e=this.magnitude();if(0!==e)for(var t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}},{key:"multiply",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]*=s[a];return this.check()}},{key:"divide",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]/=s[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(e){return this.distance(e)}},{key:"distanceToSquared",value:function(e){return this.distanceSquared(e)}},{key:"getComponent",value:function(e){return Object(_.a)(e>=0&&e<this.ELEMENTS,"index is out of range"),Object(T.a)(this[e])}},{key:"setComponent",value:function(e,t){return Object(_.a)(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}},{key:"addVectors",value:function(e,t){return this.copy(e).add(t)}},{key:"subVectors",value:function(e,t){return this.copy(e).subtract(t)}},{key:"multiplyVectors",value:function(e,t){return this.copy(e).multiply(t)}},{key:"addScaledVector",value:function(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}},{key:"x",get:function(){return this[0]},set:function(e){this[0]=Object(T.a)(e)}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=Object(T.a)(e)}}]),r}(),m="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function R(e,t,r){var n=new m(3);return n[0]=e,n[1]=t,n[2]=r,n}function b(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}var p,N;p=new m(3),m!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0),N=p;function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}r.d(t,"a",function(){return F});var I=[0,0,0],S={},F=function(e){a(r,g);var t=O(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(n.a)(this,r),e=t.call(this,-0,-0,-0),1===arguments.length&&Object(f.d)(i)?e.copy(i):(f.a.debug&&(Object(T.a)(i),Object(T.a)(s),Object(T.a)(a)),e[0]=i,e[1]=s,e[2]=a),e}return Object(i.a)(r,null,[{key:"ZERO",get:function(){return S.ZERO=S.ZERO||Object.freeze(new r(0,0,0,0))}}]),Object(i.a)(r,[{key:"set",value:function(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}},{key:"fromObject",value:function(e){return f.a.debug&&(Object(T.a)(e.x),Object(T.a)(e.y),Object(T.a)(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}},{key:"angle",value:function(e){return function(e,t){var r=R(e[0],e[1],e[2]),n=R(t[0],t[1],t[2]);b(r,r),b(n,n);var i=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}(this,e)}},{key:"cross",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],u=r[2];e[0]=i*u-s*o,e[1]=s*a-n*u,e[2]=n*o-i*a}(this,this,e),this.check()}},{key:"rotateX",value:function(e){var t=e.radians,r=e.origin;return function(e,t,r,n){var i=[],s=[];i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2]}(this,this,void 0===r?I:r,t),this.check()}},{key:"rotateY",value:function(e){var t=e.radians,r=e.origin;return function(e,t,r,n){var i=[],s=[];i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2]}(this,this,void 0===r?I:r,t),this.check()}},{key:"rotateZ",value:function(e){var t=e.radians,r=e.origin;return function(e,t,r,n){var i=[],s=[];i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2]}(this,this,void 0===r?I:r,t),this.check()}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a}(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s||1;e[0]=(r[0]*n+r[4]*i+r[8]*s)/a,e[1]=(r[1]*n+r[5]*i+r[9]*s)/a,e[2]=(r[2]*n+r[6]*i+r[10]*s)/a}(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2];e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8]}(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return function(e,t,r){var n=t[0],i=t[1];e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2]}(this,this,e),this.check()}},{key:"transformByQuaternion",value:function(e){return function(e,t,r){var n=r[0],i=r[1],s=r[2],a=r[3],o=t[0],u=t[1],c=t[2],l=i*c-s*u,h=s*o-n*c,f=n*u-i*o,_=i*f-s*h,E=s*l-n*f,d=n*h-i*l,T=2*a;l*=T,h*=T,f*=T,_*=2,E*=2,d*=2,e[0]=o+l+_,e[1]=u+h+E,e[2]=c+f+d}(this,this,e),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=Object(T.a)(e)}}]),r}()},function(e,t,r){"use strict";r.d(t,"a",function(){return u});var n=r(3);const i={};function s(e,t){var r;i[e]=!0,void 0!==t&&(r=t,n.global.console&&n.global.console.error&&n.global.console.error(r))}const a=function e(t){const r=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let t=0;t<this.attribs.length;t++){const n=new e.VertexAttrib(r);this.attribs[t]=n}this.maxAttrib=0};(a.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const o=function(e){const t=this;this.gl=e,function(e){const t=e.getError;e.getError=function(){let r;do{(r=t.apply(e))!==e.NO_ERROR&&(i[r]=!0)}while(r!==e.NO_ERROR);for(r in i)if(i[r])return delete i[r],parseInt(r,10);return e.NO_ERROR}}(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const n=t.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,e),n.attribs[e].enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const n=t.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,e),n.attribs[e].enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(n,i){switch(n){case e.ARRAY_BUFFER:t.currentArrayBuffer=i;break;case e.ELEMENT_ARRAY_BUFFER:t.currentVertexArrayObject.elementArrayBuffer=i}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(n,i){const s=t.currentVertexArrayObject.attribs[n];switch(i){case e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return s.buffer;case e.VERTEX_ATTRIB_ARRAY_ENABLED:return s.enabled;case e.VERTEX_ATTRIB_ARRAY_SIZE:return s.size;case e.VERTEX_ATTRIB_ARRAY_STRIDE:return s.stride;case e.VERTEX_ATTRIB_ARRAY_TYPE:return s.type;case e.VERTEX_ATTRIB_ARRAY_NORMALIZED:return s.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,n,i,s,a,o){const u=t.currentVertexArrayObject;u.maxAttrib=Math.max(u.maxAttrib,e);const c=u.attribs[e];return c.buffer=t.currentArrayBuffer,c.size=n,c.type=i,c.normalized=s,c.stride=a,c.offset=o,c.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{!function(e){n.global.console&&n.global.console.log&&n.global.console.log(e)}("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};function u(e){if("function"==typeof e.createVertexArray)return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const r=e.getExtension;e.getExtension=function(t){const n=r.call(this,t);return n||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new o(this)),this.__OESVertexArrayObject))}}o.prototype.VERTEX_ARRAY_BINDING_OES=34229,o.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new a(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},o.prototype.createVertexArrayOES=function(){const e=new a(this);return this.vertexArrayObjects.push(e),e},o.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},o.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof a&&e.hasBeenBound&&e.ext===this)},o.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void s(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject");const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const i=this.currentVertexArrayObject;if(n===i)return;n&&i.elementArrayBuffer===n.elementArrayBuffer||r.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,i.elementArrayBuffer);let a=this.currentArrayBuffer;const o=Math.max(n?n.maxAttrib:0,i.maxAttrib);for(let e=0;e<=o;e++){const s=i.attribs[e],o=n?n.attribs[e]:null;if(n&&s.enabled===o.enabled||(s.enabled?r.enableVertexAttribArray.call(t,e):r.disableVertexAttribArray.call(t,e)),s.enabled){let i=!1;n&&s.buffer===o.buffer||(a!==s.buffer&&(r.bindBuffer.call(t,t.ARRAY_BUFFER,s.buffer),a=s.buffer),i=!0),(i||s.cached!==o.cached)&&r.vertexAttribPointer.call(t,e,s.size,s.type,s.normalized,s.stride,s.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)}},,,,,,,,,,function(e,t,r){(function(t){const n=r(52),i="undefined"==typeof window?t:window;i.loaders=i.luma||{},e.exports=Object.assign(i.luma,n)}).call(this,r(18))},,function(e,t,r){"use strict";var n=r(21),i=r(49);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"self",{enumerable:!0,get:function(){return s.self}}),Object.defineProperty(t,"window",{enumerable:!0,get:function(){return s.window}}),Object.defineProperty(t,"global",{enumerable:!0,get:function(){return s.global}}),Object.defineProperty(t,"document",{enumerable:!0,get:function(){return s.document}}),Object.defineProperty(t,"process",{enumerable:!0,get:function(){return s.process}}),Object.defineProperty(t,"console",{enumerable:!0,get:function(){return s.console}}),Object.defineProperty(t,"isBrowser",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"isBrowserMainThread",{enumerable:!0,get:function(){return a.isBrowserMainThread}}),Object.defineProperty(t,"getBrowser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"isMobile",{enumerable:!0,get:function(){return o.isMobile}}),Object.defineProperty(t,"isElectron",{enumerable:!0,get:function(){return u.default}});var s=r(32),a=i(r(33)),o=i(r(50)),u=n(r(29))},function(e,t){e.exports=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}},function(e,t,r){"use strict";var n=r(21);Object.defineProperty(t,"__esModule",{value:!0}),t.isMobile=function(){return void 0!==i.window.orientation},t.default=function(e){if(!e&&!(0,s.default)())return"Node";if((0,a.default)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},r=e||t.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),o=-1!==r.indexOf("Trident/");if(n||o)return"IE";if(i.window.chrome)return"Chrome";if(i.window.safari)return"Safari";if(i.window.mozInnerScreenX)return"Firefox";return"Unknown"};var i=r(32),s=n(r(33)),a=n(r(29))},function(e,t){},function(e,t,r){"use strict";r.r(t);r(31);var n=r(15),i=r(14),s=r(0),a=r(3),o=r(1);const u=Object(a.isBrowser)(),c=u&&"undefined"!=typeof document,l={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function h(e={}){Object(o.a)(u,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),e=Object.assign({},l,e);const{width:t,height:r}=e;function n(t){if(e.throwOnError)throw new Error(t);return console.error(t),null}let i;e.onError=n;const{canvas:a}=e;return(i=function(e,t){const{onError:r}=t;let n=null;const i=e=>n=e.statusMessage||n;e.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;a&&(o=(o=o||e.getContext("webgl2",t))||e.getContext("experimental-webgl2",t));s&&(o=(o=o||e.getContext("webgl",t))||e.getContext("experimental-webgl",t));if(e.removeEventListener("webglcontextcreationerror",i,!1),!o)return r(`Failed to create ${a&&!s?"WebGL2":"WebGL"} context: ${n||"Unknown error"}`);return o}(function({canvas:e,width:t=800,height:r=600,onError:n}){let i;if("string"==typeof e){const t=c&&"complete"===document.readyState;t||n(`createGLContext called on canvas '${e}' before page was loaded`),i=document.getElementById(e)}else e?i=e:((i=document.createElement("canvas")).id="lumagl-canvas",i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",document.body.insertBefore(i,document.body.firstChild));return i}({canvas:a,width:t,height:r,onError:n}),e))?(function(e){const t=Object(o.f)(e)?"WebGL2":"WebGL1",r=function(e){const t=e.getParameter(s.a.VENDOR),r=e.getParameter(s.a.RENDERER),n=e.getExtension("WEBGL_debug_renderer_info"),i=n&&e.getParameter(n.UNMASKED_VENDOR_WEBGL||s.a.VENDOR),a=n&&e.getParameter(n.UNMASKED_RENDERER_WEBGL||s.a.RENDERER);return{vendor:i||t,renderer:a||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(s.a.VERSION),shadingLanguageVersion:e.getParameter(s.a.SHADING_LANGUAGE_VERSION)}}(e),n=r?`(${r.vendor},${r.renderer})`:"",i=e.debug?" debug":"";o.g.info(1,`${t}${i} context ${n}`)()}(i=f(i,e)),i):null}function f(e,t={}){if(!e||e._instrumented)return e;e._version=e._version||function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return 2;return 1}(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},l,t);const{manageState:r,debug:n}=t;return r&&Object(i.a)(e,{copyState:!1,log:(...e)=>o.g.log(1,...e)()}),u&&n&&(a.global.makeDebugContext?(e=a.global.makeDebugContext(e,t),o.g.level=Math.max(o.g.level,1)):o.g.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function _(e,t={}){if(e.canvas){return void function(e,t,r){let n="width"in r?r.width:e.canvas.clientWidth,i="height"in r?r.height:e.canvas.clientHeight;n&&i||(o.g.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=e.canvas.width||1,i=e.canvas.height||1);e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const s=e.luma.canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==t){let r=t;const s=Math.floor(n*r),a=Math.floor(i*r);e.canvas.width=s,e.canvas.height=a,e.drawingBufferWidth===s&&e.drawingBufferHeight===a||(o.g.warn("Device pixel ratio clamped")(),r=Math.min(e.drawingBufferWidth/n,e.drawingBufferHeight/i),e.canvas.width=Math.floor(n*r),e.canvas.height=Math.floor(i*r)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}(e,Object(o.c)(t.useDevicePixels),t)}const r=e.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in t&&"height"in t&&r.resize(t.width,t.height)}var E=r(9),d=r(8),T=r(22),A=function(){function e(t,r){Object(E.a)(this,e),this.name=t,this.type=r,this.sampleSize=1,this.reset()}return Object(d.a)(e,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(T.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(T.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),e}(),g=function(){function e(t){var r=t.id,n=t.stats;Object(E.a)(this,e),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return Object(d.a)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var t in this.stats)e(this.stats[t])}},{key:"getTable",value:function(){var e={};return this.forEach(function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){return e._getOrCreate(t)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var t=e.name,r=e.type;return this.stats[t]||(this.stats[t]=e instanceof A?e:new A(t,r)),this.stats[t]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),e}();const m=new class{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new g({id:e})),this.stats.get(e)}};if(a.global.luma&&"8.3.2"!==a.global.luma.VERSION)throw new Error(`luma.gl - multiple VERSIONs detected: ${a.global.luma.VERSION} vs 8.3.2`);a.global.luma||(Object(a.isBrowser)()&&o.g.log(1,"luma.gl 8.3.2 - set luma.log.level=1 (or higher) to trace rendering")(),a.global.luma=a.global.luma||{VERSION:"8.3.2",version:"8.3.2",log:o.g,stats:m,globals:{modules:{},nodeIO:{}}});a.global.luma;function R(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const b="Invalid WebGLRenderingContext",p="Requires WebGL2";function N(e){R(Object(o.e)(e),b)}function O(e){R(Object(o.f)(e),p)}function I(e,t){if("string"!=typeof t)return t;const r=Number(t);if(!isNaN(r))return r;const n=e[t=t.replace(/^.*\./,"")];return R(void 0!==n,`Accessing undefined constant GL.${t}`),n}function S(e,t){t=Number(t);for(const r in e)if(e[r]===t)return`GL.${r}`;return String(t)}const F={};function L(e="id"){return F[e]=F[e]||1,`${e}-${F[e]++}`}function y(e){return R("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function C(e){let t=!0;for(const r in e){t=!1;break}return t}function M(e,t,r,n){const i=`See luma.gl ${r} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,s=Object.getPrototypeOf(e);n.forEach(e=>{s.methodName||(s[e]=()=>{throw o.g.removed(`Calling removed method ${t}.${e}: `,i)(),new Error(e)})})}const v="Resource subclass must define virtual methods";class B{constructor(e,t={}){N(e);const{id:r,userData:n={}}=t;this.gl=e,this.id=r||L(this.constructor.name),this.userData=n,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(e=>{e.delete()}),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){R(e=I(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const e=Object(o.f)(this.gl);if(!((!("webgl2"in r)||e)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const t=r.webgl1,n="webgl2"in r?r.webgl2:r.webgl1;return e?n:t}}return this._getParameter(e,t)}getParameters(e={}){const{parameters:t,keys:r}={},n=this.constructor.PARAMETERS||{},i=Object(o.f)(this.gl),s={},a=t||Object.keys(n);for(const t of a){const a=n[t];if(a&&(!("webgl2"in a)||i)&&(!("extension"in a)||this.gl.getExtension(a.extension))){const n=r?S(this.gl,t):t;s[n]=this.getParameter(t,e),r&&"GLenum"===a.type&&(s[n]=S(this.gl,s[n]))}}return s}setParameter(e,t){R(e=I(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const e=Object(o.f)(this.gl);if(!((!("webgl2"in r)||e)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(t=I(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return M(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(v)}_deleteHandle(){throw new Error(v)}_bindHandle(){throw new Error(v)}_getOptsFromHandle(){throw new Error(v)}_getParameter(e,t){throw new Error(v)}_setParameter(e,t){throw new Error(v)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,t=m.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this.constructor.name;m.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,t=this.constructor.name){const r=m.get("Memory Usage");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const t=m.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const P="Failed to deduce GL constant from typed array";function D(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return s.a.FLOAT;case Uint16Array:return s.a.UNSIGNED_SHORT;case Uint32Array:return s.a.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return s.a.UNSIGNED_BYTE;case Int8Array:return s.a.BYTE;case Int16Array:return s.a.SHORT;case Int32Array:return s.a.INT;default:throw new Error(P)}}function x(e,{clamped:t=!0}={}){switch(e){case s.a.FLOAT:return Float32Array;case s.a.UNSIGNED_SHORT:case s.a.UNSIGNED_SHORT_5_6_5:case s.a.UNSIGNED_SHORT_4_4_4_4:case s.a.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case s.a.UNSIGNED_INT:return Uint32Array;case s.a.UNSIGNED_BYTE:return t?Uint8ClampedArray:Uint8Array;case s.a.BYTE:return Int8Array;case s.a.SHORT:return Int16Array;case s.a.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function U({data:e,width:t,height:r}){const n=Math.round(t/2),i=Math.round(r/2),s=new Uint8Array(n*i*4);for(let r=0;r<i;r++)for(let i=0;i<n;i++)for(let a=0;a<4;a++)s[4*(r*n+i)+a]=e[4*(2*r*t+2*i)+a];return{data:s,width:n,height:i}}function w(e,t,r){const{removedProps:n={},deprecatedProps:i={},replacedProps:s={}}=r;for(const r in n)if(r in t){const t=n[r]?`${e}.${n[r]}`:"N/A";o.g.removed(`${e}.${r}`,t)()}for(const r in i)if(r in t){const t=i[r];o.g.deprecated(`${e}.${r}`,`${e}.${t}`)()}let a=null;for(const r in s)if(r in t){const n=s[r];o.g.deprecated(`${e}.${r}`,`${e}.${n}`)(),(a=a||Object.assign({},t))[n]=t[r],delete a[r]}return a||t}const G={offset:0,stride:0,type:s.a.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},H={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class V{static getBytesPerElement(e){return x(e.type||s.a.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return R(e.size),x(e.type||s.a.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new V(...[G,...e])}constructor(...e){e.forEach(e=>this._assign(e)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return V.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return V.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=w("Accessor",e,H)).type&&(this.type=e.type,e.type!==s.a.INT&&e.type!==s.a.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const j=10,k={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},X={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:k},W={removedProps:k};class z extends B{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?s.a.COPY_READ_BUFFER:s.a.ARRAY_BUFFER),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/V.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/V.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=w("Buffer",e,X),this.usage=e.usage||s.a.STATIC_DRAW,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=w("Buffer",e,W))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new V(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,i=e.byteLength||e.length;R(t);const a=this.gl.webgl2?s.a.COPY_WRITE_BUFFER:this.target;return this.gl.bindBuffer(a,this.handle),0!==n||void 0!==i?(O(this.gl),this.gl.bufferSubData(this.target,r,t,n,i)):this.gl.bufferSubData(a,r,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:r=0,size:n}){const{gl:i}=this;return O(i),i.bindBuffer(s.a.COPY_READ_BUFFER,e.handle),i.bindBuffer(s.a.COPY_WRITE_BUFFER,this.handle),i.copyBufferSubData(s.a.COPY_READ_BUFFER,s.a.COPY_WRITE_BUFFER,t,r,n),i.bindBuffer(s.a.COPY_READ_BUFFER,null),i.bindBuffer(s.a.COPY_WRITE_BUFFER,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}={}){O(this.gl);const i=x(this.accessor.type||s.a.FLOAT,{clamped:!1}),a=this._getAvailableElementCount(t),o=r;let u,c;e?u=(c=e.length)-o:c=o+(u=Math.min(a,n||a));const l=Math.min(a,u);return R((n=n||l)<=l),e=e||new i(c),this.gl.bindBuffer(s.a.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(s.a.COPY_READ_BUFFER,t,e,r,n),this.gl.bindBuffer(s.a.COPY_READ_BUFFER,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}={}){return e===s.a.UNIFORM_BUFFER||e===s.a.TRANSFORM_FEEDBACK_BUFFER?void 0!==n?this.gl.bindBufferRange(e,t,this.handle,r,n):(R(0===r),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return e===s.a.UNIFORM_BUFFER||e===s.a.TRANSFORM_FEEDBACK_BUFFER?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(j,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=0,r=e.byteLength+t){R(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,j),this.bytesUsed=r,this._trackAllocatedMemory(r);const i=D(e);return R(i),this.setAccessor(new V(this.accessor,{type:i})),this}_setByteLength(e,t=this.usage){R(e>=0),this._trackDeallocatedMemory();let r=e;0===e&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?s.a.COPY_WRITE_BUFFER:this.target}_getAvailableElementCount(e){const t=e/x(this.accessor.type||s.a.FLOAT,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}_inferType(e){this.accessor.type||this.setAccessor(new V(this.accessor,{type:D(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return o.g.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return o.g.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return o.g.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return o.g.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new V(this.accessor,e),this}}const $={[s.a.RGB]:{dataFormat:s.a.RGB,types:[s.a.UNSIGNED_BYTE,s.a.UNSIGNED_SHORT_5_6_5]},[s.a.RGBA]:{dataFormat:s.a.RGBA,types:[s.a.UNSIGNED_BYTE,s.a.UNSIGNED_SHORT_4_4_4_4,s.a.UNSIGNED_SHORT_5_5_5_1]},[s.a.ALPHA]:{dataFormat:s.a.ALPHA,types:[s.a.UNSIGNED_BYTE]},[s.a.LUMINANCE]:{dataFormat:s.a.LUMINANCE,types:[s.a.UNSIGNED_BYTE]},[s.a.LUMINANCE_ALPHA]:{dataFormat:s.a.LUMINANCE_ALPHA,types:[s.a.UNSIGNED_BYTE]},[s.a.R32F]:{dataFormat:s.a.RED,types:[s.a.FLOAT],gl2:!0},[s.a.RG32F]:{dataFormat:s.a.RG,types:[s.a.FLOAT],gl2:!0},[s.a.RGB32F]:{dataFormat:s.a.RGB,types:[s.a.FLOAT],gl2:!0},[s.a.RGBA32F]:{dataFormat:s.a.RGBA,types:[s.a.FLOAT],gl2:!0}},K={[s.a.RED]:1,[s.a.RED_INTEGER]:1,[s.a.RG]:2,[s.a.RG_INTEGER]:2,[s.a.RGB]:3,[s.a.RGB_INTEGER]:3,[s.a.RGBA]:4,[s.a.RGBA_INTEGER]:4,[s.a.DEPTH_COMPONENT]:1,[s.a.DEPTH_STENCIL]:1,[s.a.ALPHA]:1,[s.a.LUMINANCE]:1,[s.a.LUMINANCE_ALPHA]:2},Y={[s.a.FLOAT]:4,[s.a.UNSIGNED_INT]:4,[s.a.INT]:4,[s.a.UNSIGNED_SHORT]:2,[s.a.SHORT]:2,[s.a.HALF_FLOAT]:2,[s.a.BYTE]:1,[s.a.UNSIGNED_BYTE]:1};const Z=[s.a.LINEAR,s.a.NEAREST],Q=a.global.WebGLBuffer||function(){};class q extends B{static isSupported(e,{format:t,linearFiltering:r}={}){let n=!0;return t&&(n=(n=n&&function(e,t){const r=$[t];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;const n=Object(o.f)(e)&&r.gl2||r.gl1;return"string"==typeof n?e.getExtension(n):n}(e,t))&&(!r||function(e,t){const r=$[t];switch(r&&r.types[0]){case s.a.FLOAT:return e.getExtension("OES_texture_float_linear");case s.a.HALF_FLOAT:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,t))),n}constructor(e,t){const{id:r=L("texture"),handle:n,target:i}=t;super(e,{id:r,handle:n}),this.target=i,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let t=e.data;if(t instanceof Promise)return t.then(t=>this.initialize(Object.assign({},e,{pixels:t,data:t}))),this;const{pixels:r=null,format:n=s.a.RGBA,border:i=0,recreate:a=!1,parameters:u={},pixelStore:c={},textureUnit:l}=e;t||(t=r);let{width:h,height:f,dataFormat:_,type:E,compressed:d=!1,mipmaps:T=!0}=e;const{depth:A=0}=e;return({width:h,height:f,compressed:d,dataFormat:_,type:E}=this._deduceParameters({format:n,type:E,dataFormat:_,compressed:d,data:t,width:h,height:f})),this.width=h,this.height=f,this.depth=A,this.format=n,this.type=E,this.dataFormat=_,this.border=i,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(s.a.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),T&&this._isNPOT()&&(o.g.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),T=!1,this._updateForNPOT(u)),this.mipmaps=T,this.setImageData({data:t,width:h,height:f,depth:A,format:n,type:E,dataFormat:_,border:i,mipmaps:T,parameters:c,compressed:d}),T&&this.generateMipmap(),this.setParameters(u),a&&(this.data=t),this}resize({height:e,width:t,mipmaps:r=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(e={}){return this._isNPOT()?(o.g.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Object(n.d)(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:i=0,format:a=this.format,border:u=this.border,offset:c=0,parameters:l={}}=e;let{data:h=null,type:f=this.type,width:_=this.width,height:E=this.height,dataFormat:d=this.dataFormat,compressed:T=!1}=e;h||(h=r),({type:f,dataFormat:d,compressed:T,width:_,height:E}=this._deduceParameters({format:a,type:f,dataFormat:d,compressed:T,data:h,width:_,height:E}));const{gl:A}=this;A.bindTexture(this.target,this.handle);let g=null;if(({data:h,dataType:g}=this._getDataType({data:h,compressed:T})),Object(n.d)(this.gl,l,()=>{switch(g){case"null":A.texImage2D(t,i,a,_,E,u,d,f,h);break;case"typed-array":A.texImage2D(t,i,a,_,E,u,d,f,h,c);break;case"buffer":O(A),A.bindBuffer(s.a.PIXEL_UNPACK_BUFFER,h.handle||h),A.texImage2D(t,i,a,_,E,u,d,f,c),A.bindBuffer(s.a.PIXEL_UNPACK_BUFFER,null);break;case"browser-object":Object(o.f)(A)?A.texImage2D(t,i,a,_,E,u,d,f,h):A.texImage2D(t,i,a,d,f,h);break;case"compressed":for(const[e,r]of h.entries())A.compressedTexImage2D(t,e,r.format,r.width,r.height,u,r.data);break;default:R(!1,"Unknown image data type")}}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const e=K[this.dataFormat]||4,t=Y[this.type]||1;this._trackAllocatedMemory(this.width*this.height*e*t,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:r=null,x:i=0,y:a=0,width:u=this.width,height:c=this.height,level:l=0,format:h=this.format,type:f=this.type,dataFormat:_=this.dataFormat,compressed:E=!1,offset:d=0,border:T=this.border,parameters:A={}}){if(({type:f,dataFormat:_,compressed:E,width:u,height:c}=this._deduceParameters({format:h,type:f,dataFormat:_,compressed:E,data:r,width:u,height:c})),R(0===this.depth,"texSubImage not supported for 3D textures"),r||(r=t),r&&r.data){const e=r;r=e.data,u=e.shape[0],c=e.shape[1]}r instanceof z&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Object(n.d)(this.gl,A,()=>{E?this.gl.compressedTexSubImage2D(e,l,i,a,u,c,h,r):null===r?this.gl.texSubImage2D(e,l,i,a,u,c,_,f,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(e,l,i,a,u,c,_,f,r,d):r instanceof Q?(O(this.gl),this.gl.bindBuffer(s.a.PIXEL_UNPACK_BUFFER,r),this.gl.texSubImage2D(e,l,i,a,u,c,_,f,d),this.gl.bindBuffer(s.a.PIXEL_UNPACK_BUFFER,null)):Object(o.f)(this.gl)?this.gl.texSubImage2D(e,l,i,a,u,c,_,f,r):this.gl.texSubImage2D(e,l,i,a,_,f,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return o.g.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(s.a.ACTIVE_TEXTURE)-s.a.TEXTURE0}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof z?{data:e.handle,dataType:"buffer"}:e instanceof Q?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:i,dataFormat:s,type:a,compressed:o}=e;const u=$[t];return s=s||u&&u.dataFormat,a=a||u&&u.types[0],o=o||u&&u.compressed,({width:n,height:i}=this._deduceImageSize(r,n,i)),{dataFormat:s,type:a,compressed:o,width:n,height:i,format:t,data:r}}_deduceImageSize(e,t,r){let n;return R(n="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement?{width:e.width,height:e.height}:"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:r}:{width:t>=0?t:1,height:r>=0?r:1},"Could not deduced texture size"),R(void 0===t||n.width===t,"Deduced texture width does not match supplied width"),R(void 0===r||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case s.a.TEXTURE_WIDTH:return this.width;case s.a.TEXTURE_HEIGHT:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case s.a.TEXTURE_MIN_LOD:case s.a.TEXTURE_MAX_LOD:this.gl.texParameterf(this.handle,e,t);break;case s.a.TEXTURE_WIDTH:case s.a.TEXTURE_HEIGHT:R(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!Object(o.f)(this.gl)&&(!(!this.width||!this.height)&&(!y(this.width)||!y(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case s.a.TEXTURE_MIN_FILTER:-1===Z.indexOf(t)&&(t=s.a.LINEAR);break;case s.a.TEXTURE_WRAP_S:case s.a.TEXTURE_WRAP_T:t!==s.a.CLAMP_TO_EDGE&&(t=s.a.CLAMP_TO_EDGE)}return t}}let J="";class ee extends q{static isSupported(e,t){return q.isSupported(e,t)}constructor(e,t={}){var r,n;N(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:(r=t.data,R("string"==typeof r),r=J+r,new Promise((e,t)=>{try{const i=new Image;i.onload=()=>e(i),i.onerror=()=>t(new Error(`Could not load image ${r}.`)),i.crossOrigin=n&&n.crossOrigin||"anonymous",i.src=r}catch(e){t(e)}}))})),super(e,Object.assign({},t,{target:s.a.TEXTURE_2D})),this.initialize(t),Object.seal(this)}}const te="EXT_color_buffer_float";var re={[s.a.DEPTH_COMPONENT16]:{bpp:2},[s.a.DEPTH_COMPONENT24]:{gl2:!0,bpp:3},[s.a.DEPTH_COMPONENT32F]:{gl2:!0,bpp:4},[s.a.STENCIL_INDEX8]:{bpp:1},[s.a.DEPTH_STENCIL]:{bpp:4},[s.a.DEPTH24_STENCIL8]:{gl2:!0,bpp:4},[s.a.DEPTH32F_STENCIL8]:{gl2:!0,bpp:5},[s.a.RGBA4]:{bpp:2},[s.a.RGB565]:{bpp:2},[s.a.RGB5_A1]:{bpp:2},[s.a.R8]:{gl2:!0,bpp:1},[s.a.R8UI]:{gl2:!0,bpp:1},[s.a.R8I]:{gl2:!0,bpp:1},[s.a.R16UI]:{gl2:!0,bpp:2},[s.a.R16I]:{gl2:!0,bpp:2},[s.a.R32UI]:{gl2:!0,bpp:4},[s.a.R32I]:{gl2:!0,bpp:4},[s.a.RG8]:{gl2:!0,bpp:2},[s.a.RG8UI]:{gl2:!0,bpp:2},[s.a.RG8I]:{gl2:!0,bpp:2},[s.a.RG16UI]:{gl2:!0,bpp:4},[s.a.RG16I]:{gl2:!0,bpp:4},[s.a.RG32UI]:{gl2:!0,bpp:8},[s.a.RG32I]:{gl2:!0,bpp:8},[s.a.RGB8]:{gl2:!0,bpp:3},[s.a.RGBA8]:{gl2:!0,bpp:4},[s.a.RGB10_A2]:{gl2:!0,bpp:4},[s.a.RGBA8UI]:{gl2:!0,bpp:4},[s.a.RGBA8I]:{gl2:!0,bpp:4},[s.a.RGB10_A2UI]:{gl2:!0,bpp:4},[s.a.RGBA16UI]:{gl2:!0,bpp:8},[s.a.RGBA16I]:{gl2:!0,bpp:8},[s.a.RGBA32I]:{gl2:!0,bpp:16},[s.a.RGBA32UI]:{gl2:!0,bpp:16},[s.a.R16F]:{gl2:te,bpp:2},[s.a.RG16F]:{gl2:te,bpp:4},[s.a.RGBA16F]:{gl2:te,bpp:8},[s.a.R32F]:{gl2:te,bpp:4},[s.a.RG32F]:{gl2:te,bpp:8},[s.a.RGBA32F]:{gl2:te,bpp:16},[s.a.R11F_G11F_B10F]:{gl2:te,bpp:4}};class ne extends B{static isSupported(e,{format:t}={format:null}){return!t||function(e,t,r){const n=r[t];if(!n)return!1;const i=Object(o.f)(e)&&n.gl2||n.gl1;return"string"==typeof i?e.getExtension(i):i}(e,t,re)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(s.a.RENDERBUFFER,t,s.a.SAMPLES)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:r=1,samples:n=0}){return R(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(s.a.RENDERBUFFER,this.handle),0!==n&&Object(o.f)(this.gl)?this.gl.renderbufferStorageMultisample(s.a.RENDERBUFFER,n,e,t,r):this.gl.renderbufferStorage(s.a.RENDERBUFFER,e,t,r),this.format=e,this.width=t,this.height=r,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*re[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(s.a.RENDERBUFFER,e)}_syncHandle(e){this.format=this.getParameter(s.a.RENDERBUFFER_INTERNAL_FORMAT),this.width=this.getParameter(s.a.RENDERBUFFER_WIDTH),this.height=this.getParameter(s.a.RENDERBUFFER_HEIGHT),this.samples=this.getParameter(s.a.RENDERBUFFER_SAMPLES)}_getParameter(e){return this.gl.bindRenderbuffer(s.a.RENDERBUFFER,this.handle),this.gl.getRenderbufferParameter(s.a.RENDERBUFFER,e)}}const ie=256,se=1024,ae=16384,oe=6144,ue=6145,ce=6146,le=34041,he="clear: bad arguments";function fe(e,{framebuffer:t=null,color:r=null,depth:i=null,stencil:s=null}={}){const a={};t&&(a.framebuffer=t);let o=0;r&&(o|=ae,!0!==r&&(a.clearColor=r)),i&&(o|=ie,!0!==i&&(a.clearDepth=i)),s&&(o|=se,!0!==i&&(a.clearStencil=i)),R(0!==o,he),Object(n.d)(e,a,()=>{e.clear(o)})}function _e(e){switch(e){case s.a.ALPHA:case s.a.R32F:case s.a.RED:return 1;case s.a.RG32F:case s.a.RG:return 2;case s.a.RGB:case s.a.RGB32F:return 3;case s.a.RGBA:case s.a.RGBA32F:return 4;default:return R(!1),0}}const Ee=[s.a.TEXTURE_CUBE_MAP_POSITIVE_X,s.a.TEXTURE_CUBE_MAP_NEGATIVE_X,s.a.TEXTURE_CUBE_MAP_POSITIVE_Y,s.a.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.a.TEXTURE_CUBE_MAP_POSITIVE_Z,s.a.TEXTURE_CUBE_MAP_NEGATIVE_Z];class de extends q{constructor(e,t={}){N(e),super(e,Object.assign({},t,{target:s.a.TEXTURE_CUBE_MAP})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:r={}}=e;this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)})}subImage({face:e,data:t,x:r=0,y:n=0,mipmapLevel:i=0}){return this._subImage({target:e,data:t,x:r,y:n,mipmapLevel:i})}async setCubeMapImageData({width:e,height:t,pixels:r,data:n,border:i=0,format:a=s.a.RGBA,type:u=s.a.UNSIGNED_BYTE}){const{gl:c}=this,l=r||n,h=await Promise.all(Ee.map(e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])}));this.bind(),Ee.forEach((r,n)=>{h[n].length>1&&!1!==this.opts.mipmaps&&o.g.warn(`${this.id} has mipmap and multiple LODs.`)(),h[n].forEach((n,s)=>{e&&t?c.texImage2D(r,s,a,e,t,i,a,u,n):c.texImage2D(r,s,a,a,u,n)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:i,data:a,border:o=0,format:u=s.a.RGBA,type:c=s.a.UNSIGNED_BYTE}=e,{gl:l}=this,h=i||a;return this.bind(),h instanceof Promise?h.then(r=>this.setImageDataForFace(Object.assign({},e,{face:t,data:r,pixels:r}))):this.width||this.height?l.texImage2D(t,0,u,r,n,o,u,c,h):l.texImage2D(t,0,u,u,c,h),this}}de.FACES=Ee;class Te extends q{static isSupported(e){return Object(o.f)(e)}constructor(e,t={}){O(e),super(e,t=Object.assign({depth:1},t,{target:s.a.TEXTURE_3D,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=s.a.RGBA,width:r,height:i,depth:a=1,border:o=0,format:u,type:c=s.a.UNSIGNED_BYTE,offset:l=0,data:h,parameters:f={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Object(n.d)(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,e,t,r,i,a,o,u,c,h),h instanceof z&&(this.gl.bindBuffer(s.a.PIXEL_UNPACK_BUFFER,h.handle),this.gl.texImage3D(this.target,e,t,r,i,a,o,u,c,l))}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const e=K[this.dataFormat]||4,t=Y[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*e*t,"Texture")}return this.loaded=!0,this}}function Ae(e,t){const{gl:r,width:n,height:i,id:a}=e;return new pe(r,Object.assign({},t,{id:`framebuffer-for-${a}`,width:n,height:i,attachments:{[s.a.COLOR_ATTACHMENT0]:e}}))}function ge(e,{sourceX:t=0,sourceY:r=0,sourceFormat:n=s.a.RGBA,sourceAttachment:i=s.a.COLOR_ATTACHMENT0,target:a=null,sourceWidth:o,sourceHeight:u,sourceType:c}={}){const{framebuffer:l,deleteFramebuffer:h}=Re(e);R(l);const{gl:f,handle:_,attachments:E}=l;o=o||l.width,u=u||l.height,i===s.a.COLOR_ATTACHMENT0&&null===_&&(i=s.a.FRONT),R(E[i]),a=function(e,t,r,n,i){if(e)return e;const a=x(t=t||s.a.UNSIGNED_BYTE,{clamped:!1}),o=_e(r);return new a(n*i*o)}(a,c=c||E[i].type,n,o,u),c=c||D(a);const d=f.bindFramebuffer(s.a.FRAMEBUFFER,_);return f.readPixels(t,r,o,u,n,c,a),f.bindFramebuffer(s.a.FRAMEBUFFER,d||null),h&&l.delete(),a}function me(e,{sourceAttachment:t=s.a.COLOR_ATTACHMENT0,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}={}){let n=ge(e,{sourceAttachment:t}),{width:i,height:a}=e;for(;a>r;)({data:n,width:i,height:a}=U({data:n,width:i,height:a}));!function({data:e,width:t,height:r,bytesPerPixel:n=4,temp:i}){const s=t*n;i=i||new Uint8Array(s);for(let t=0;t<r/2;++t){const n=t*s,a=(r-t-1)*s;i.set(e.subarray(n,n+s)),e.copyWithin(n,a,a+s),e.set(i,a)}}({data:n,width:i,height:a});const o=document.createElement("canvas");o.width=i,o.height=a;const u=o.getContext("2d"),c=u.createImageData(i,a);return c.data.set(n),u.putImageData(c,0,0),o.toDataURL()}function Re(e){return e instanceof pe?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Ae(e),deleteFramebuffer:!0}}const be="Multiple render targets not supported";class pe extends B{static isSupported(e,{colorBufferFloat:t,colorBufferHalfFloat:r}={}){let n=!0;return t&&(n=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(n=n&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),n}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new pe(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=s.a.COLOR_ATTACHMENT0,this.drawBuffers=[s.a.COLOR_ATTACHMENT0],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[s.a.COLOR_ATTACHMENT0]||null}get texture(){return this.attachments[s.a.COLOR_ATTACHMENT0]||null}get depth(){return this.attachments[s.a.DEPTH_ATTACHMENT]||this.attachments[s.a.DEPTH_STENCIL_ATTACHMENT]||null}get stencil(){return this.attachments[s.a.STENCIL_ATTACHMENT]||this.attachments[s.a.DEPTH_STENCIL_ATTACHMENT]||null}initialize({width:e=1,height:t=1,attachments:r=null,color:n=!0,depth:i=!0,stencil:s=!1,check:a=!0,readBuffer:o,drawBuffers:u}){if(R(e>=0&&t>=0,"Width and height need to be integers"),this.width=e,this.height=t,r)for(const n in r){const i=r[n];(Array.isArray(i)?i[0]:i).resize({width:e,height:t})}else r=this._createDefaultAttachments(n,i,s,e,t);this.update({clearAttachments:!0,attachments:r,readBuffer:o,drawBuffers:u}),r&&a&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();super.delete()}update({attachments:e={},readBuffer:t,drawBuffers:r,clearAttachments:n=!1,resizeAttachments:i=!0}){this.attach(e,{clearAttachments:n,resizeAttachments:i});const{gl:a}=this,o=a.bindFramebuffer(s.a.FRAMEBUFFER,this.handle);return t&&this._setReadBuffer(t),r&&this._setDrawBuffers(r),a.bindFramebuffer(s.a.FRAMEBUFFER,o||null),this}resize({width:e,height:t}={}){if(null===this.handle)return R(void 0===e&&void 0===t),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight),e!==this.width&&t!==this.height&&o.g.log(2,`Resizing framebuffer ${this.id} to ${e}x${t}`)();for(const r in this.attachments)this.attachments[r].resize({width:e,height:t});return this.width=e,this.height=t,this}attach(e,{clearAttachments:t=!1,resizeAttachments:r=!0}={}){const n={};t&&Object.keys(this.attachments).forEach(e=>{n[e]=null}),Object.assign(n,e);const i=this.gl.bindFramebuffer(s.a.FRAMEBUFFER,this.handle);for(const e in n){R(void 0!==e,"Misspelled framebuffer binding point?");const t=Number(e),i=n[t];let s=i;if(s)if(s instanceof ne)this._attachRenderbuffer({attachment:t,renderbuffer:s});else if(Array.isArray(i)){const[e,r=0,n=0]=i;s=e,this._attachTexture({attachment:t,texture:e,layer:r,level:n})}else this._attachTexture({attachment:t,texture:s,layer:0,level:0});else this._unattach(t);r&&s&&s.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(s.a.FRAMEBUFFER,i||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(e=>!this.attachments[e]).forEach(e=>{delete this.attachments[e]})}checkStatus(){const{gl:e}=this,t=this.getStatus();if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error(function(e){return(pe.STATUS||{})[e]||`Framebuffer error ${e}`}(t));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(s.a.FRAMEBUFFER,this.handle),r=e.checkFramebufferStatus(s.a.FRAMEBUFFER);return e.bindFramebuffer(s.a.FRAMEBUFFER,t||null),r}clear({color:e,depth:t,stencil:r,drawBuffers:i=[]}={}){const a=this.gl.bindFramebuffer(s.a.FRAMEBUFFER,this.handle);return(e||t||r)&&fe(this.gl,{color:e,depth:t,stencil:r}),i.forEach((e,t)=>{!function(e,{framebuffer:t=null,buffer:r=oe,drawBuffer:i=0,value:s=[0,0,0,0]}={}){O(e),Object(n.d)(e,{framebuffer:t},()=>{switch(r){case oe:switch(s.constructor){case Int32Array:e.clearBufferiv(r,i,s);break;case Uint32Array:e.clearBufferuiv(r,i,s);break;case Float32Array:default:e.clearBufferfv(r,i,s)}break;case ue:e.clearBufferfv(ue,0,[s]);break;case ce:e.clearBufferiv(ce,0,[s]);break;case le:const[t,n]=s;e.clearBufferfi(le,0,t,n);break;default:R(!1,he)}})}({drawBuffer:t,value:e})}),this.gl.bindFramebuffer(s.a.FRAMEBUFFER,a||null),this}readPixels(e={}){return o.g.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return o.g.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return o.g.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return o.g.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return o.g.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return o.g.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:t=0,y:r=0,width:n,height:i}){const{gl:a}=this;O(a);const o=a.bindFramebuffer(s.a.READ_FRAMEBUFFER,this.handle);return 0===t&&0===r&&void 0===n&&void 0===i?a.invalidateFramebuffer(s.a.READ_FRAMEBUFFER,e):a.invalidateFramebuffer(s.a.READ_FRAMEBUFFER,e,t,r,n,i),a.bindFramebuffer(s.a.READ_FRAMEBUFFER,o),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return null===n&&(this.gl.bindFramebuffer(s.a.FRAMEBUFFER,this.handle),n=this.gl.getFramebufferAttachmentParameter(s.a.FRAMEBUFFER,e,t),this.gl.bindFramebuffer(s.a.FRAMEBUFFER,null)),r&&n>1e3&&(n=S(this.gl,n)),n}getAttachmentParameters(e=s.a.COLOR_ATTACHMENT0,t,r=this.constructor.ATTACHMENT_PARAMETERS||[]){const n={};for(const i of r){n[t?S(this.gl,i):i]=this.getAttachmentParameter(e,i,t)}return n}getParameters(e=!0){const t=Object.keys(this.attachments),r={};for(const n of t){const t=Number(n);r[e?S(this.gl,t):t]=this.getAttachmentParameters(t,e)}return r}show(){return"undefined"!=typeof window&&window.open(me(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>o.g.level||"undefined"==typeof window)return this;t=t||`Framebuffer ${this.id}`;const r=me(this,{maxHeight:100});return o.g.image({logLevel:e,message:t,image:r},t)(),this}bind({target:e=s.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=s.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,i){let a=null;return e&&((a=a||{})[s.a.COLOR_ATTACHMENT0]=new ee(this.gl,{id:`${this.id}-color0`,pixels:null,format:s.a.RGBA,type:s.a.UNSIGNED_BYTE,width:n,height:i,mipmaps:!1,parameters:{[s.a.TEXTURE_MIN_FILTER]:s.a.LINEAR,[s.a.TEXTURE_MAG_FILTER]:s.a.LINEAR,[s.a.TEXTURE_WRAP_S]:s.a.CLAMP_TO_EDGE,[s.a.TEXTURE_WRAP_T]:s.a.CLAMP_TO_EDGE}}),this.ownResources.push(a[s.a.COLOR_ATTACHMENT0])),t&&r?((a=a||{})[s.a.DEPTH_STENCIL_ATTACHMENT]=new ne(this.gl,{id:`${this.id}-depth-stencil`,format:s.a.DEPTH24_STENCIL8,width:n,height:111}),this.ownResources.push(a[s.a.DEPTH_STENCIL_ATTACHMENT])):t?((a=a||{})[s.a.DEPTH_ATTACHMENT]=new ne(this.gl,{id:`${this.id}-depth`,format:s.a.DEPTH_COMPONENT16,width:n,height:i}),this.ownResources.push(a[s.a.DEPTH_ATTACHMENT])):r&&R(!1),a}_unattach(e){const t=this.attachments[e];t&&(t instanceof ne?this.gl.framebufferRenderbuffer(s.a.FRAMEBUFFER,e,s.a.RENDERBUFFER,null):this.gl.framebufferTexture2D(s.a.FRAMEBUFFER,e,s.a.TEXTURE_2D,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=s.a.COLOR_ATTACHMENT0,renderbuffer:t}){const{gl:r}=this;r.framebufferRenderbuffer(s.a.FRAMEBUFFER,e,s.a.RENDERBUFFER,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=s.a.COLOR_ATTACHMENT0,texture:t,layer:r,level:n}){const{gl:i}=this;switch(i.bindTexture(t.target,t.handle),t.target){case s.a.TEXTURE_2D_ARRAY:case s.a.TEXTURE_3D:i.framebufferTextureLayer(s.a.FRAMEBUFFER,e,t.target,n,r);break;case s.a.TEXTURE_CUBE_MAP:const a=function(e){return e<s.a.TEXTURE_CUBE_MAP_POSITIVE_X?e+s.a.TEXTURE_CUBE_MAP_POSITIVE_X:e}(r);i.framebufferTexture2D(s.a.FRAMEBUFFER,e,a,t.handle,n);break;case s.a.TEXTURE_2D:i.framebufferTexture2D(s.a.FRAMEBUFFER,e,s.a.TEXTURE_2D,t.handle,n);break;default:R(!1,"Illegal texture type")}i.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const{gl:t}=this;Object(o.f)(t)?t.readBuffer(e):R(e===s.a.COLOR_ATTACHMENT0||e===s.a.BACK,be),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this;if(Object(o.f)(t))t.drawBuffers(e);else{const r=t.getExtension("WEBGL.draw_buffers");r?r.drawBuffersWEBGL(e):R(1===e.length&&(e[0]===s.a.COLOR_ATTACHMENT0||e[0]===s.a.BACK),be)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=function(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in Ie)void 0===e.luma.caps[t]&&(e.luma.caps[t]=Le(e,t));return e.luma.caps}(this.gl);switch(e){case s.a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:return t.WEBGL2?null:0;case s.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE:case s.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:case s.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:case s.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:case s.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:case s.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:return t.WEBGL2?null:8;case s.a.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:return t.WEBGL2?null:s.a.UNSIGNED_INT;case s.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:return t.WEBGL2||t.EXT_sRGB?null:s.a.LINEAR;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(s.a.FRAMEBUFFER,e)}}const Ne=[s.a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME,s.a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE,s.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,s.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE,s.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE,s.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE,s.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE,s.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE,s.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE];pe.ATTACHMENT_PARAMETERS=Ne;const Oe={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};var Ie={[Oe.WEBGL2]:[!1,!0],[Oe.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Oe.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Oe.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Oe.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Oe.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Oe.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Oe.FLOAT_BLEND]:["EXT_float_blend"],[Oe.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Oe.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Oe.TEXTURE_FLOAT]:["OES_texture_float",!0],[Oe.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Oe.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Oe.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Oe.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Oe.COLOR_ATTACHMENT_RGBA32F]:[function(e){const t=new ee(e,{format:e.RGBA,type:e.FLOAT,dataFormat:e.RGBA}),r=new pe(e,{id:"test-framebuffer",check:!1,attachments:{[e.COLOR_ATTACHMENT0]:t}}),n=r.getStatus();return t.delete(),r.delete(),n===e.FRAMEBUFFER_COMPLETE},"EXT_color_buffer_float"],[Oe.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Oe.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Oe.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Oe.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Oe.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Oe.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const Se=2;function Fe(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>Le(e,t))}function Le(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[t]&&(e.luma.caps[t]=function(e,t){const r=Ie[t];let n;R(r,t);const i=Object(o.f)(e)&&r[1]||r[0];if("function"==typeof i)n=i(e);else if(Array.isArray(i)){n=!0;for(const t of i)n=n&&Boolean(e.getExtension(t))}else"string"==typeof i?n=Boolean(e.getExtension(i)):"boolean"==typeof i?n=i:R(!1);return n}(e,t)),e.luma.caps[t]||o.g.log(Se,`Feature: ${t} not supported`)(),e.luma.caps[t]}const ye=34918,Ce=34919,Me=35007,ve=36795,Be=35976,Pe=35887,De=36202;class xe extends B{static isSupported(e,t=[]){const r=Object(o.f)(e),n=Fe(e,Oe.TIMER_QUERY);let i=r||n;for(const e of t)switch(e){case"queries":i=i&&r;break;case"timers":i=i&&n;break;default:R(!1)}return i}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Me)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?De:Pe)}beginTransformFeedbackQuery(){return this.begin(Be)}begin(e){return this._queryPending?this:(this.target=e,this.gl.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl.getQueryParameter(this.handle,Ce);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl.getParameter(ve)}getResult(){return this.gl.getQueryParameter(this.handle,ye)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const i=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)}),this._pollingPromise}_createHandle(){return xe.isSupported(this.gl)?this.gl.createQuery():null}_deleteHandle(){this.gl.deleteQuery(this.handle)}}function Ue(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}const we=Object(a.isBrowser)()&&"undefined"!=typeof document;let Ge=0;class He{constructor(e={}){const{onCreateContext:t=(e=>h(e)),onAddHTML:r=null,onInitialize:n=(()=>{}),onRender:i=(()=>{}),onFinalize:s=(()=>{}),onError:a,gl:u=null,glOptions:c={},debug:l=!1,createFramebuffer:f=!1,autoResizeViewport:_=!0,autoResizeDrawingBuffer:E=!0,stats:d=m.get(`animation-loop-${Ge++}`)}=e;let{useDevicePixels:T=!0}=e;"useDevicePixelRatio"in e&&(o.g.deprecated("useDevicePixelRatio","useDevicePixels")(),T=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:n,onRender:i,onFinalize:s,onError:a,gl:u,glOptions:c,debug:l,createFramebuffer:f},this.gl=u,this.needsRedraw=null,this.timeline=null,this.stats=d,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:_,autoResizeDrawingBuffer:E,useDevicePixels:T}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return R("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=xe.isSupported(this.gl,["timers"])?new xe(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(e=>{this._running&&(this._addCallbackData(e||{}),!1!==e&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this}stop(){return this._running&&(this._finalizeCallbackData(),Ue(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,t=1){const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return o.g.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};Ue(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=we?new Promise((e,t)=>{we&&"complete"===document.readyState?e(document):window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(e){var t;this.display&&this.display.requestAnimationFrame(e)||(t=e,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60))}_renderFrame(...e){this.display?this.display._renderFrame(...e):this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._onSetupFrame?this._onSetupFrame(this.animationProps):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?f(this.props.gl,e):this.onCreateContext(e),!Object(o.e)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(n.b)(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&_(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new pe(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Ve="vs",je="fs";function ke(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Xe={number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},array:{validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function We(e){let t=ze(e);return"object"===t?e?"type"in e?Object.assign({},e,Xe[e.type]):"value"in e?(t=ze(e.value),Object.assign({type:t},e,Xe[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},Xe[t])}function ze(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const $e="vs",Ke="fs";class Ye{constructor({name:e,vs:t,fs:r,dependencies:n=[],uniforms:i,getUniforms:s,deprecations:a=[],defines:o={},inject:u={},vertexShader:c,fragmentShader:l}){ke("string"==typeof e),this.name=e,this.vs=t||c,this.fs=r||l,this.getModuleUniforms=s,this.dependencies=n,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=o,this.injections=function(e){const t={vs:{},fs:{}};for(const r in e){let n=e[r];const i=r.slice(0,2);"string"==typeof n&&(n={injection:n}),t[i][r]=n}return t}(u),i&&(this.uniforms=function(e){const t={};for(const r in e){const n=We(e[r]);t[r]=n}return t}(i))}getModuleSource(e){let t;switch(e){case $e:t=this.vs||"";break;case Ke:t=this.fs||"";break;default:ke(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}\n${t}// END MODULE_${this.name}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),e}_defaultGetUniforms(e={}){const t={},r=this.uniforms;for(const n in r){const i=r[n];n in e&&!i.private?(i.validate&&ke(i.validate(e[n],i),`${this.name}: invalid ${n}`),t[n]=e[n]):t[n]=i.value}return t}}function Ze(e){return Qe(function e(t,r){return t.map(t=>t instanceof Ye?t:(ke("string"!=typeof t,`Shader module use by name is deprecated. Import shader module '${t}' and use it directly.`),ke(t.name,"shader module has no name"),(t=new Ye(t)).dependencies=e(t.dependencies),t))}(e))}function Qe(e){const t={},r={};return qe({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((e,t)=>r[t]-r[e]).map(e=>t[e])}function qe({modules:e,level:t,moduleMap:r,moduleDepth:n}){if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)r[i.name]=i,(void 0===n[i.name]||n[i.name]<t)&&(n[i.name]=t);for(const i of e)i.dependencies&&qe({modules:i.dependencies,level:t+1,moduleMap:r,moduleDepth:n})}const Je=7936,et=7937,tt=7938,rt=35724,nt={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},it={};Object.keys(nt).forEach(e=>{it[e]=e});const st={};function at(e,t,r={}){const n=nt[t];if(ke(n,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},r=e.userAgent||t.userAgent||"",n=-1!==r.indexOf("MSIE "),i=-1!==r.indexOf("Trident/");return n||i}(r))return!0;if(t in st)return st[t];const i=`#extension GL_${n[0]} : ${r.behavior||"enable"}\nvoid main(void) {}`,s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,i),e.compileShader(s);const a=e.getShaderParameter(s,e.COMPILE_STATUS);return e.deleteShader(s),st[t]=a,a}function ot(e,t){const r=nt[t];ke(r,t);const n=function(e){return Boolean(e&&2===e._version)}(e)&&r[1]||r[0],i="string"==typeof n?Boolean(e.getExtension(n)):n;return ke(!1===i||!0===i),i}function ut(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>ot(e,t))}function ct(e){switch(function(e){const t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||Je),n=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||et);return{gpuVendor:function(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(r,n),vendor:r,renderer:n,version:e.getParameter(tt),shadingLanguageVersion:e.getParameter(rt)}}(e).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}const lt={[Ve]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[je]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},ht="__LUMA_INJECT_DECLARATIONS__",ft=/void\s+main\s*\([^)]*\)\s*\{\n?/,_t=/}\n?[^{}]*$/,Et=[];function dt(e,t,r,n){const i=t===Ve;for(const t in r){const n=r[t];n.sort((e,t)=>e.order-t.order),Et.length=n.length;for(let e=0,t=n.length;e<t;++e)Et[e]=n[e].injection;const s=`${Et.join("\n")}\n`;switch(t){case"vs:#decl":i&&(e=e.replace(ht,s));break;case"vs:#main-start":i&&(e=e.replace(ft,e=>e+s));break;case"vs:#main-end":i&&(e=e.replace(_t,e=>s+e));break;case"fs:#decl":i||(e=e.replace(ht,s));break;case"fs:#main-start":i||(e=e.replace(ft,e=>e+s));break;case"fs:#main-end":i||(e=e.replace(_t,e=>s+e));break;default:e=e.replace(t,e=>e+s)}}return e=e.replace(ht,""),n&&(e=e.replace(/\}\s*$/,e=>e+lt[t])),e}function Tt(e){const t={};return ke(Array.isArray(e)&&e.length>1),e.forEach(e=>{for(const r in e)t[r]=t[r]?`${t[r]}\n${e[r]}`:e[r]}),t}function At(e,t,r){switch(t){case 300:return r?function(e){return e.replace(/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n").replace(/^[ \t]*attribute[ \t]+(.+;)/gm,"in $1").replace(/^[ \t]*varying[ \t]+(.+;)/gm,"out $1").replace(/\btexture2D\(/g,"texture(").replace(/\btextureCube\(+/g,"texture(").replace(/\btexture2DLodEXT\(/g,"textureLod(").replace(/\btextureCubeLodEXT\(/g,"textureLod(")}(e):function(e){return e.replace(/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n").replace(/^[ \t]*varying[ \t]+(.+;)/gm,"in $1").replace(/\btexture2D\(/g,"texture(").replace(/\btextureCube\(/g,"texture(").replace(/\btexture2DLodEXT\(/g,"textureLod(").replace(/\btextureCubeLodEXT\(/g,"textureLod(")}(e);case 100:return r?function(e){return e.replace(/^#version[ \t]+300[ \t]+es/,"#version 100").replace(/^[ \t]*in[ \t]+(.+;)/gm,"attribute $1").replace(/^[ \t]*out[ \t]+(.+;)/gm,"varying $1").replace(/\btexture\(/g,"texture2D(").replace(/\btextureLod\(/g,"texture2DLodEXT(")}(e):function(e){const t=(e=e.replace(/^#version[ \t]+300[ \t]+es/,"#version 100").replace(/^[ \t]*in[ \t]+/gm,"varying ").replace(/\btexture\(/g,"texture2D(").replace(/\btextureLod\(/g,"texture2DLodEXT(")).match(gt);if(t){const r=t[1];e=e.replace(gt,"").replace(new RegExp(`\\b${r}\\b`,"g"),"gl_FragColor")}return e}(e);default:throw new Error(`unknown GLSL version ${t}`)}}const gt=/^[ \t]*out[ \t]+vec4[ \t]+(\w+)[ \t]*;\s+/m;const mt=`\n\n${ht}\n\n`,Rt={[Ve]:"vertex",[je]:"fragment"},bt="precision highp float;\n\n";function pt(e,{id:t,source:r,type:n,modules:i,defines:s={},hookFunctions:a=[],inject:o={},transpileToGLSL100:u=!1,prologue:c=!0,log:l}){ke("string"==typeof r,"shader source must be a string");const h=n===Ve,f=r.split("\n");let _=100,E="",d=r;0===f[0].indexOf("#version ")?(_=300,E=f[0],d=f.slice(1).join("\n")):E=`#version ${_}`;const T={};i.forEach(e=>{Object.assign(T,e.getDefines())}),Object.assign(T,s);let A=c?`${E}\n${function({id:e,source:t,type:r}){return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${e}_${Rt[r]}\n\n`:""}({id:t,source:r,type:n})}\n${function({type:e}){return`\n#define SHADER_TYPE_${Rt[e].toUpperCase()}\n`}({type:n})}\n${ct(e)}\n${function(e,t,r){let n="#if (__VERSION__ > 120)\n\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return ut(e,it.GLSL_FRAG_DEPTH)&&(n+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),ut(e,it.GLSL_DERIVATIVES)&&at(e,it.GLSL_DERIVATIVES)&&(n+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),ut(e,it.GLSL_FRAG_DATA)&&at(e,it.GLSL_FRAG_DATA,{behavior:"require"})&&(n+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),ut(e,it.GLSL_TEXTURE_LOD)&&(n+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),n}(e)}\n${function(e={}){let t=0,r="";for(const n in e){0===t&&(r+="\n// APPLICATION DEFINES\n"),t++;const i=e[n];(i||Number.isFinite(i))&&(r+=`#define ${n.toUpperCase()} ${e[n]}\n`)}0===t&&(r+="\n");return r}(T)}\n${h?"":bt}\n`:`${E}\n`;a=function(e){const t={vs:{},fs:{}};return e.forEach(e=>{let r;"string"!=typeof e?e=(r=e).hook:r={},e=e.trim();const[n,i]=e.split(":"),s=e.replace(/\(.+/,"");t[n][s]=Object.assign(r,{signature:i})}),t}(a);const g={},m={},R={};for(const e in o){const t="string"==typeof o[e]?{injection:o[e],order:0}:o[e],r=e.match(/^(v|f)s:(#)?([\w-]+)$/);if(r){const n=r[2],i=r[3];n?"decl"===i?m[e]=[t]:R[e]=[t]:g[e]=[t]}else R[e]=[t]}for(const e of i){l&&e.checkDeprecations(d,l),A+=e.getModuleSource(n,_);const t=e.injections[n];for(const e in t){const r=e.match(/^(v|f)s:#([\w-]+)$/);if(r){const n="decl"===r[2]?m:R;n[e]=n[e]||[],n[e].push(t[e])}else g[e]=g[e]||[],g[e].push(t[e])}}return A=dt(A+=mt,n,m),A+=function(e,t){let r="";for(const n in e){const i=e[n];if(r+=`void ${i.signature} {\n`,i.header&&(r+=`  ${i.header}`),t[n]){const e=t[n];e.sort((e,t)=>e.order-t.order);for(const t of e)r+=`  ${t.injection}\n`}i.footer&&(r+=`  ${i.footer}`),r+="}\n"}return r}(a[n],g),A=At(A=dt(A+=d,n,R),u?100:_,h)}function Nt(e){return function(t){const r={};for(const n of e){const e=n.getUniforms(t,r);Object.assign(r,e)}return r}}const Ot={[s.a.FLOAT]:wt.bind(null,"uniform1fv",Ct,1,Gt),[s.a.FLOAT_VEC2]:wt.bind(null,"uniform2fv",Ct,2,Gt),[s.a.FLOAT_VEC3]:wt.bind(null,"uniform3fv",Ct,3,Gt),[s.a.FLOAT_VEC4]:wt.bind(null,"uniform4fv",Ct,4,Gt),[s.a.INT]:wt.bind(null,"uniform1iv",Mt,1,Gt),[s.a.INT_VEC2]:wt.bind(null,"uniform2iv",Mt,2,Gt),[s.a.INT_VEC3]:wt.bind(null,"uniform3iv",Mt,3,Gt),[s.a.INT_VEC4]:wt.bind(null,"uniform4iv",Mt,4,Gt),[s.a.BOOL]:wt.bind(null,"uniform1iv",Mt,1,Gt),[s.a.BOOL_VEC2]:wt.bind(null,"uniform2iv",Mt,2,Gt),[s.a.BOOL_VEC3]:wt.bind(null,"uniform3iv",Mt,3,Gt),[s.a.BOOL_VEC4]:wt.bind(null,"uniform4iv",Mt,4,Gt),[s.a.FLOAT_MAT2]:wt.bind(null,"uniformMatrix2fv",Ct,4,Ht),[s.a.FLOAT_MAT3]:wt.bind(null,"uniformMatrix3fv",Ct,9,Ht),[s.a.FLOAT_MAT4]:wt.bind(null,"uniformMatrix4fv",Ct,16,Ht),[s.a.SAMPLER_2D]:Ut,[s.a.SAMPLER_CUBE]:Ut,[s.a.UNSIGNED_INT]:wt.bind(null,"uniform1uiv",vt,1,Gt),[s.a.UNSIGNED_INT_VEC2]:wt.bind(null,"uniform2uiv",vt,2,Gt),[s.a.UNSIGNED_INT_VEC3]:wt.bind(null,"uniform3uiv",vt,3,Gt),[s.a.UNSIGNED_INT_VEC4]:wt.bind(null,"uniform4uiv",vt,4,Gt),[s.a.FLOAT_MAT2x3]:wt.bind(null,"uniformMatrix2x3fv",Ct,6,Ht),[s.a.FLOAT_MAT2x4]:wt.bind(null,"uniformMatrix2x4fv",Ct,8,Ht),[s.a.FLOAT_MAT3x2]:wt.bind(null,"uniformMatrix3x2fv",Ct,6,Ht),[s.a.FLOAT_MAT3x4]:wt.bind(null,"uniformMatrix3x4fv",Ct,12,Ht),[s.a.FLOAT_MAT4x2]:wt.bind(null,"uniformMatrix4x2fv",Ct,8,Ht),[s.a.FLOAT_MAT4x3]:wt.bind(null,"uniformMatrix4x3fv",Ct,12,Ht),[s.a.SAMPLER_3D]:Ut,[s.a.SAMPLER_2D_SHADOW]:Ut,[s.a.SAMPLER_2D_ARRAY]:Ut,[s.a.SAMPLER_2D_ARRAY_SHADOW]:Ut,[s.a.SAMPLER_CUBE_SHADOW]:Ut,[s.a.INT_SAMPLER_2D]:Ut,[s.a.INT_SAMPLER_3D]:Ut,[s.a.INT_SAMPLER_CUBE]:Ut,[s.a.INT_SAMPLER_2D_ARRAY]:Ut,[s.a.UNSIGNED_INT_SAMPLER_2D]:Ut,[s.a.UNSIGNED_INT_SAMPLER_3D]:Ut,[s.a.UNSIGNED_INT_SAMPLER_CUBE]:Ut,[s.a.UNSIGNED_INT_SAMPLER_2D_ARRAY]:Ut},It={},St={},Ft={},Lt=[0];function yt(e,t,r,n){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Lt[0]=e,e=Lt);const i=e.length;if(i%t&&o.g.warn(`Uniform size should be multiples of ${t}`,e)(),e instanceof r)return e;let s=n[i];s||(s=new r(i),n[i]=s);for(let t=0;t<i;t++)s[t]=e[t];return s}function Ct(e,t){return yt(e,t,Float32Array,It)}function Mt(e,t){return yt(e,t,Int32Array,St)}function vt(e,t){return yt(e,t,Uint32Array,Ft)}function Bt(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function Pt(e,t,r){const n=Ot[r.type];if(!n)throw new Error(`Unknown GLSL uniform type ${r.type}`);return n().bind(null,e,t)}function Dt(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;const t=Math.min(e.length,16);for(let r=0;r<t;++r)if(!Number.isFinite(e[r]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof q||(e instanceof ne||e instanceof pe&&Boolean(e.texture))))}function xt(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t]){const n=e[t];for(let e=0,t=r.length;e<t;++e)n[e]=r[e]}else e[t]=r.slice();else e[t]=r}function Ut(){let e=null;return(t,r,n)=>{const i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function wt(e,t,r,n){let i=null,s=null;return(a,o,u)=>{const c=t(u,r),l=c.length;let h=!1;if(null===i)i=new Float32Array(l),s=l,h=!0;else{R(s===l,"Uniform length cannot change.");for(let e=0;e<l;++e)if(c[e]!==i[e]){h=!0;break}}return h&&(n(a,e,o,c),i.set(c)),h}}function Gt(e,t,r,n){e[t](r,n)}function Ht(e,t,r,n){e[t](r,!1,n)}function Vt(e,t="unnamed"){const r=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:t}const jt=35632,kt=35633;function Xt(e,t,r,n){const i=e.split(/\r?\n/),s={},a={},o=n||Vt(t)||"(unnamed)",u=`${function(e){switch(e){case jt:return"fragment";case kt:return"vertex";default:return"unknown type"}}(r)} shader ${o}`;for(let t=0;t<i.length;t++){const r=i[t];if(r.length<=1)continue;const n=r.split(":"),o=n[0],c=parseInt(n[2],10);if(isNaN(c))throw new Error(`GLSL compilation error in ${u}: ${e}`);"WARNING"!==o?s[c]=r:a[c]=r}const c=function(e,t=1,r=": "){const n=e.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((e,n)=>{const s=n+t,a=String(s).length,o=zt(s,i-a);return o+r+e})}(t);return{shaderName:u,errors:Wt(s,c),warnings:Wt(a,c)}}function Wt(e,t){let r="";for(let n=0;n<t.length;n++){const i=t[n];if((e[n+3]||e[n+2]||e[n+1])&&(r+=`${i}\n`,e[n+1])){const t=e[n+1],i=t.split(":",3),s=i[0],a=parseInt(i[1],10)||0;r+=zt(`^^^ ${s}: ${t.substring(i.join(":").length+1).trim()}\n\n`,a)}}return r}function zt(e,t){let r="";for(let e=0;e<t;++e)r+=" ";return`${r}${e}`}const $t="Shader: GLSL source code must be a JavaScript string";class Kt extends B{static getTypeName(e){switch(e){case s.a.VERTEX_SHADER:return"vertex-shader";case s.a.FRAGMENT_SHADER:return"fragment-shader";default:return R(!1),"unknown"}}constructor(e,t){N(e),R("string"==typeof t.source,$t),super(e,{id:Vt(t.source,null)||t.id||L(`unnamed ${Kt.getTypeName(t.shaderType)}`)}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){const t=Vt(e,null);t&&(this.id=L(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Kt.getTypeName(this.shaderType)}:${this.id}`}getName(){return Vt(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL.debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100\n${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(s.a.COMPILE_STATUS)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:t,errors:r,warnings:n}=Xt(e,this.source,this.shaderType,this.id);throw o.g.error(`GLSL compilation errors in ${t}\n${r}`)(),o.g.warn(`GLSL compilation warnings in ${t}\n${n}`)(),new Error(`GLSL compilation errors in ${t}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(s.a.SHADER_TYPE),source:this.getSource()}}}class Yt extends Kt{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:s.a.VERTEX_SHADER}))}_createHandle(){return this.gl.createShader(s.a.VERTEX_SHADER)}}class Zt extends Kt{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:s.a.FRAGMENT_SHADER}))}_createHandle(){return this.gl.createShader(s.a.FRAGMENT_SHADER)}}const Qt=5120,qt=5121,Jt=5122,er=5123,tr=0,rr=1,nr=2,ir=3,sr=4,ar=5,or=6,ur=5126,cr={[ur]:[ur,1,"float"],35664:[ur,2,"vec2"],35665:[ur,3,"vec3"],35666:[ur,4,"vec4"],5124:[5124,1,"int"],35667:[5124,2,"ivec2"],35668:[5124,3,"ivec3"],35669:[5124,4,"ivec4"],5125:[5125,1,"uint"],36294:[5125,2,"uvec2"],36295:[5125,3,"uvec3"],36296:[5125,4,"uvec4"],35670:[ur,1,"bool"],35671:[ur,2,"bvec2"],35672:[ur,3,"bvec3"],35673:[ur,4,"bvec4"],35674:[ur,8,"mat2"],35685:[ur,8,"mat2x3"],35686:[ur,8,"mat2x4"],35675:[ur,12,"mat3"],35687:[ur,12,"mat3x2"],35688:[ur,12,"mat3x4"],35676:[ur,16,"mat4"],35689:[ur,16,"mat4x2"],35690:[ur,16,"mat4x3"]};function lr(e){switch(e){case tr:return tr;case rr:case ir:case nr:return rr;case sr:case ar:case or:return sr;default:return R(!1),0}}function hr(e){const t=cr[e];if(!t)return null;const[r,n]=t;return{type:r,components:n}}function fr(e,t){switch(e){case Qt:case qt:case Jt:case er:e=ur}for(const r in cr){const[n,i,s]=cr[r];if(n===e&&i===t)return{glType:r,name:s}}return null}class _r{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const{name:r,type:i,size:s}=t.getActiveAttrib(e.handle,n),a=t.getAttribLocation(e.handle,r);a>=0&&this._addAttribute(a,r,i,s)}this.attributeInfos.sort((e,t)=>e.location-t.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!Object(o.f)(t))return;const r=t.getProgramParameter(e.handle,t.TRANSFORM_FEEDBACK_VARYINGS);for(let n=0;n<r;n++){const{name:r,type:i,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,r,i,s)}this.varyingInfos.sort((e,t)=>e.location-t.location)}_addAttribute(e,t,r,n){const{type:i,components:s}=hr(r),a={type:i,size:n*s};this._inferProperties(e,t,a);const o={location:e,name:t,accessor:new V(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[e]=o,this.attributeInfosByName[o.name]=o}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:i,components:s}=hr(r),a={location:e,name:t,accessor:new V({type:i,size:n*s})};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}const Er=4,dr=35981,Tr=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Ar extends B{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",Tr),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){const{hash:t,vs:r,fs:n,varyings:i,bufferMode:s=dr}=e;return this.hash=t||"",this.vs="string"==typeof r?new Yt(this.gl,{id:`${e.id}-vs`,source:r}):r,this.fs="string"==typeof n?new Zt(this.gl,{id:`${e.id}-fs`,source:n}):n,R(this.vs instanceof Yt),R(this.fs instanceof Zt),this.uniforms={},this._textureUniforms={},this._texturesRenderable=!0,i&&i.length>0&&(O(this.gl),this.varyings=i,this.gl.transformFeedbackVaryings(this.handle,i,s)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new _r(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=s.a.TRIANGLES,vertexCount:r,offset:i=0,start:a,end:u,isIndexed:c=!1,indexType:l=s.a.UNSIGNED_SHORT,instanceCount:h=0,isInstanced:f=h>0,vertexArray:_=null,transformFeedback:E,framebuffer:d,parameters:T={},uniforms:A,samplers:g}){if((A||g)&&(o.g.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(A||{})),o.g.priority>=e){const n=d?d.id:"default",i=`mode=${S(this.gl,t)} verts=${r} `+`instances=${h} indexType=${S(this.gl,l)} `+`isInstanced=${f} isIndexed=${c} `+`Framebuffer=${n}`;o.g.log(e,i)()}return R(_),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||f&&0===h)&&(_.bindForDraw(r,h,()=>{if(void 0!==d&&(T=Object.assign({},T,{framebuffer:d})),E){const e=lr(t);E.begin(e)}this._bindTextures(),Object(n.d)(this.gl,T,()=>{c&&f?this.gl.drawElementsInstanced(t,r,l,i,h):c&&Object(o.f)(this.gl)&&!isNaN(a)&&!isNaN(u)?this.gl.drawRangeElements(t,a,u,r,l,i):c?this.gl.drawElements(t,r,l,i):f?this.gl.drawArraysInstanced(t,i,r,h):this.gl.drawArrays(t,i,r)}),E&&E.end()}),!0)}setUniforms(e={}){o.g.priority>=2&&function(e,t,r){for(const n in e){const i=e[n];if((!r||Boolean(r[n]))&&!Dt(i))throw t=t?`${t} `:"",console.error(`${t} Bad uniform ${n}`,i),new Error(`${t} Bad uniform ${n}`)}}(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let e=r,i=!1;if(e instanceof pe&&(e=e.texture),e instanceof q)if(i=this.uniforms[t]!==r){void 0===n.textureIndex&&(n.textureIndex=this._textureIndexCounter++);const r=e,{textureIndex:i}=n;r.bind(i),e=i,r.loaded||(this._texturesRenderable=!1),this._textureUniforms[t]=r}else e=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(e)||i)&&xt(this.uniforms,t,r)}}return this}_areTexturesRenderable(){if(this._texturesRenderable)return!0;this._texturesRenderable=!0;for(const e in this._textureUniforms){const t=this._textureUniforms[e];this._texturesRenderable=this._texturesRenderable&&t.loaded}return this._texturesRenderable}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const e of t){switch(this.gl.getShaderParameter(this.handle,s.a.SHADER_TYPE)){case s.a.VERTEX_SHADER:r.vs=new Yt({handle:e});break;case s.a.FRAGMENT_SHADER:r.fs=new Zt({handle:e})}}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const e=this._getName();this.id=L(e)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=(e=e.replace(/shader/i,""))?`${e}-program`:"program"}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),o.g.time(Er,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),o.g.timeEnd(Er,`linkProgram for ${this._getName()}`)(),e.debug||o.g.level>0){if(!e.getProgramParameter(this.handle,e.LINK_STATUS))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,e.VALIDATE_STATUS))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(s.a.ACTIVE_UNIFORMS);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n,isArray:i}=Bt(r.name);let s=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=Pt(e,s,r),r.size>1)for(let t=0;t<r.size;t++)s=e.getUniformLocation(this.handle,`${n}[${t}]`),this._uniformSetters[`${n}[${t}]`]=Pt(e,s,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl.uniformBlockBinding(this.handle,e,t)}}class gr{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new gr(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:t="",fs:r="",defines:n={},inject:i={},varyings:s=[],bufferMode:a=35981,transpileToGLSL100:o=!1}=e,u=this._getModuleList(e.modules),c=this._getHash(t),l=this._getHash(r),h=u.map(e=>this._getHash(e.name)).sort(),f=s.map(e=>this._getHash(e)),_=Object.keys(n).sort(),E=Object.keys(i).sort(),d=[],T=[];for(const e of _)d.push(this._getHash(e)),d.push(this._getHash(n[e]));for(const e of E)T.push(this._getHash(e)),T.push(this._getHash(i[e]));const A=`${c}/${l}D${d.join("/")}M${h.join("/")}I${T.join("/")}V${f.join("/")}H${this.stateHash}B${a}${o?"T":""}`;if(!this._programCache[A]){const e=function(e,t){const{vs:r,fs:n}=t,i=Ze(t.modules||[]);return{gl:e,vs:pt(e,Object.assign({},t,{source:r,type:Ve,modules:i})),fs:pt(e,Object.assign({},t,{source:n,type:je,modules:i})),getUniforms:Nt(i)}}(this.gl,{vs:t,fs:r,modules:u,inject:i,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:o});this._programCache[A]=new Ar(this.gl,{hash:A,vs:e.vs,fs:e.fs,varyings:s,bufferMode:a}),this._getUniforms[A]=e.getUniforms||(e=>{}),this._useCounts[A]=0}return this._useCounts[A]++,this._programCache[A]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let e=0,i=this._defaultModules.length;e<i;++e){const i=this._defaultModules[e],s=i.name;t[n++]=i,r[s]=!0}for(let i=0,s=e.length;i<s;++i){const s=e[i],a=s.name;r[a]||(t[n++]=s,r[a]=!0)}return t.length=n,t}}let mr=null;function Rr(e,t){var r;return new e((r=e.BYTES_PER_ELEMENT*t,(!mr||mr.byteLength<r)&&(mr=new ArrayBuffer(r)),mr),0,t)}var br=r(11),pr=r(24),Nr=r(25);const Or="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ir extends B{static isSupported(e,t={}){return!t.constantAttributeZero||(Object(o.f)(e)||"Chrome"===function(e){if(!e&&!Object(pr.a)())return"Node";if(Object(Nr.a)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},r=e||t.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),i=-1!==r.indexOf("Trident/");return n||i?"IE":br.b.chrome?"Chrome":br.b.safari?"Safari":br.b.mozInnerScreenX?"Firefox":"Unknown"}())}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Ir(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Ir.MAX_ATTRIBUTES=Ir.MAX_ATTRIBUTES||e.getParameter(e.MAX_VERTEX_ATTRIBS),Ir.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:Ir._setConstantFloatArray(e,t,r);break;case Int32Array:Ir._setConstantIntArray(e,t,r);break;case Uint32Array:Ir._setConstantUintArray(e,t,r);break;default:R(!1)}}constructor(e,t={}){const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.initialize(t),Object.seal(this)}delete(){super.delete(),this.buffer&&this.buffer.delete()}get MAX_ATTRIBUTES(){return Ir.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t={}){return R(!e||e.target===s.a.ELEMENT_ARRAY_BUFFER,Or),this.bind(()=>{this.gl.bindBuffer(s.a.ELEMENT_ARRAY_BUFFER,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===s.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,r);const{size:n,type:i,stride:a,offset:u,normalized:c,integer:l,divisor:h}=r,{gl:f}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(f.ARRAY_BUFFER,t.handle),l?(R(Object(o.f)(f)),f.vertexAttribIPointer(e,n,i,a,u)):f.vertexAttribPointer(e,n,i,c,a,u),f.enableVertexAttribArray(e),f.vertexAttribDivisor(e,h||0)}),this}enable(e,t=!0){return!t&&0===e&&!Ir.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t,r){const n=this._normalizeConstantArrayValue(t,r),i=n.byteLength*e,s=n.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new z(this.gl,i),a=(a=a||this.buffer.reallocate(i))||!this._compareConstantArrayValues(n,this.bufferValue)){const e=Rr(t.constructor,s);!function({target:e,source:t,start:r=0,count:n=1}){const i=t.length,s=n*i;let a=0;for(let n=r;a<i;a++)e[n++]=t[a];for(;a<s;)a<s-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+s-a),a=s)}({target:e,source:n,start:0,count:s}),this.buffer.subData(e),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e,t){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:R(!1)}}static _setConstantIntArray(e,t,r){switch(R(Object(o.f)(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:R(!1)}}static _setConstantUintArray(e,t,r){switch(R(Object(o.f)(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:R(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl.bindVertexArray(e)}_getParameter(e,{location:t}){return R(Number.isFinite(t)),this.bind(()=>{switch(e){case s.a.VERTEX_ATTRIB_ARRAY_POINTER:return this.gl.getVertexAttribOffset(t,e);default:return this.gl.getVertexAttrib(t,e)}})}}const Sr="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Fr=/^(.+)__LOCATION_([0-9]+)$/,Lr=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class yr{constructor(e,t={}){const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ir(e),M(this,"VertexArray","v6.0",Lr),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(s.a.ARRAY_BUFFER,null)}),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,r={}){if(t.target===s.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,r);const{location:n,accessor:i}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=i,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,i)),this}setConstant(e,t,r={}){const{location:n,accessor:i}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t,i),this.values[n]=t,this.accessors[n]=i,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new z(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof z&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(s.a.ARRAY_BUFFER,this.buffer.handle),this.gl.vertexAttribPointer(e,1,s.a.FLOAT,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof z&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const{location:i,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(i)||i<0)return this.unused[e]=t,o.g.once(3,()=>`unused value ${e} in ${this.id}`)(),this;const a=this._getAttributeInfo(s||i);if(!a)return{location:-1,accessor:null};const u=this.accessors[i]||{},c=V.resolve(a.accessor,u,r,n),{size:l,type:h}=c;return R(Number.isFinite(l)&&Number.isFinite(h)),{location:i,accessor:c}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=Fr.exec(e),n=r?r[1]:e,i=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+i,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof z)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof z){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else{if(!(t.buffer instanceof z))throw new Error(Sr);{const r=t;this.setBuffer(e,r.buffer,r)}}}_setConstantAttributes(e,t){const r=Math.max(0|e,0|t);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)n=this.values[e],ArrayBuffer.isView(n)&&this._setConstantAttribute(e,n)}_setConstantAttributeZero(e,t){if(Ir.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){Ir.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:i}=n,s=i>0;if(e.isInstanced=e.isInstanced||s,r instanceof z){const t=r;if(s){const r=t.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,r)}else{const r=t.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,r)}}}setElements(e=null,t={}){return o.g.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}class Cr extends B{static isSupported(e){return Object(o.f)(e)}constructor(e,t={}){O(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,C(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:i,byteOffset:s}=this._getBufferParams(t);return r<0?(this.unused[e]=n,o.g.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,s,i),this)}begin(e=s.a.POINTS){return this.gl.bindTransformFeedback(s.a.TRANSFORM_FEEDBACK,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(s.a.TRANSFORM_FEEDBACK,null),this}_getBufferParams(e){let t,r,n;return e instanceof z==!1?(n=e.buffer,r=e.byteSize,t=e.byteOffset):n=e,void 0===t&&void 0===r||(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,r=0,n){const i=t&&t.handle;return i&&void 0!==n?this.gl.bindBufferRange(s.a.TRANSFORM_FEEDBACK_BUFFER,e,i,r,n):this.gl.bindBufferBase(s.a.TRANSFORM_FEEDBACK_BUFFER,e,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(s.a.TRANSFORM_FEEDBACK,this.handle)}}function Mr(e,t={}){const{isInteger:r=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){const{maxElts:r=16,size:n=1}=t;let i="[";for(let s=0;s<e.length&&s<r;++s)s>0&&(i+=`,${s%n==0?" ":""}`),i+=Mr(e[s],t);return`${i}${e.length>r?"...":"]"}`}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return r?"0":"0.";if(r)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const n=e.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function vr(e,t,r,n){const{gl:i}=e;if(!t)return{[n]:"null","Format ":"N/A"};let s,a,o,u="NOT PROVIDED",c="N/A",l="N/A",h="N/A";if(r&&(u=r.type,c=r.size,s=-1!==(u=String(u).replace("Array","")).indexOf("nt")),t instanceof z){const e=t,{data:f,modified:_}=e.getDebugData();let E;if(a=_?"*":"",o=f,l=(h=e.byteLength)/f.BYTES_PER_ELEMENT/c,r){E=`${r.divisor>0?"I ":"P "} ${l} (x${c}=${h} bytes ${S(i,u)})`}else s=!0,E=`${h} bytes`;return{[n]:`${a}${Mr(o,{size:c,isInteger:s})}`,"Format ":E}}return{[n]:`${Mr(o=t,{size:c=t.length,isInteger:s=-1!==(u=String(t.constructor.name).replace("Array","")).indexOf("nt")})} (constant)`,"Format ":`${c}x${u} (constant)`}}function Br(e,t){const{type:r,size:n}=t,i=fr(r,n);return i?`${e} (${i.name})`:e}function Pr({header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}={}){R(t);const i=t._uniformSetters,s={},a=Object.keys(i).sort();let o=0;for(const t of a)t.match(".*_.*")||t.match(".*Matrix")||Dr({table:s,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;for(const t of a)t.match(".*Matrix")&&Dr({table:s,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;for(const t of a)s[t]||Dr({table:s,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;let u=0;const c={};if(!n)for(const t in r){const n=r[t];s[t]||(u++,c[t]={Type:`NOT USED: ${n}`,[e]:Mr(n)})}return{table:s,count:o,unusedTable:c,unusedCount:u}}function Dr({table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:i}){const s=r[n],a=function(e){return null!=e}(s);return(!i||!a)&&(e[n]={[t]:a?Mr(s):"N/A","Uniform Type":a?s:"NOT PROVIDED"},!0)}function xr(e){const{type:t,size:r}=e.accessor,n=fr(t,r);return n?`${n.name} ${e.name}`:e.name}const Ur={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function wr(e,t){const{attributeMap:r=Ur}=t||{};return r&&r[e]||e}function Gr(e,t){let r;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors"}switch(r){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}R(Number.isFinite(t.size),`attribute ${e} needs size`)}const Hr=2,Vr=1e4,jr="Model needs drawMode and vertexCount",kr=()=>{},Xr={};class Wr{constructor(e,t={}){const{id:r=L("model")}=t;R(Object(o.e)(e)),this.id=r,this.gl=e,this.id=t.id||L("Model"),this.lastLogTime=0,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||gr.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:n,modules:i,defines:a,inject:o,varyings:u,bufferMode:c,transpileToGLSL100:l}=e;this.programProps={program:t,vs:r,fs:n,modules:i,defines:a,inject:o,varyings:u,bufferMode:c,transpileToGLSL100:l},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:s.a.TRIANGLES,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},R(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),jr)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:n,modules:i,defines:s,inject:a,varyings:o,bufferMode:u,transpileToGLSL100:c}=e;this.programProps={program:t,vs:r,fs:n,modules:i,defines:s,inject:a,varyings:o,bufferMode:u,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return R(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return R(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(e,t,r){const n={};let i=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=wr(s,r);if("indices"===s)i=a;else if(a.constant)n[o]=a.value;else{const t=a.value,r={...a};delete r.value,n[o]=[new z(e,t),r],Gr(s,r)}}if(i){const t=i.value||i;R(t instanceof Uint16Array||t instanceof Uint32Array,'attribute array for "indices" must be of integer type');const r={size:1,isIndexed:void 0===i.isIndexed||i.isIndexed};n.indices=[new z(e,{data:t,target:s.a.ELEMENT_ARRAY_BUFFER}),r]}return n}(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(C(e))return this;const t={};for(const r in e){const n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return fe(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:n={},attributes:i={},transformFeedback:s=this.transformFeedback,parameters:a={},vertexArray:u=this.vertexArray}=e;let c;this.setAttributes(i),this.updateModuleSettings(t),this.setUniforms(n),o.g.priority>=Hr&&(c=this._logDrawCallStart(Hr));const l=this.vertexArray.getDrawParams(),{isIndexed:h=l.isIndexed,indexType:f=l.indexType,indexOffset:_=l.indexOffset,vertexArrayInstanced:E=l.isInstanced}=this.props;E&&!this.isInstanced&&o.g.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:d,instanceCount:T}=this,{onBeforeRender:A=kr,onAfterRender:g=kr}=this.props;A(),this.program.setUniforms(this.uniforms);const m=this.program.draw(Object.assign(Xr,e,{logPriority:c,uniforms:null,framebuffer:r,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:u,transformFeedback:s,isIndexed:h,indexType:f,isInstanced:d,instanceCount:T,offset:h?_:0}));return g(),o.g.priority>=Hr&&this._logDrawCallEnd(c,u,r),m}transform(e={}){const{discard:t=!0,feedbackBuffers:r,unbindModels:n=[]}=e;let{parameters:i}=e;r&&this._setFeedbackBuffers(r),t&&(i=Object.assign({},i,{[s.a.RASTERIZER_DISCARD]:t})),n.forEach(e=>e.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:i}))}finally{n.forEach(e=>e.vertexArray.bindBuffers())}return this}render(e={}){return o.g.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(e=null){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:r,modules:n,inject:i,defines:s,varyings:a,bufferMode:o,transpileToGLSL100:u}=this.programProps;t=this.programManager.get({vs:e,fs:r,modules:n,inject:i,defines:s,varyings:a,bufferMode:o,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}R(t instanceof Ar,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new yr(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof z&&t.delete()}}_setAnimationProps(e){if(this.animated){R(e,"Model.draw(): animated uniforms but no animationProps");const t=this._evaluateAnimateUniforms(e);Object.assign(this.uniforms,t)}}_setFeedbackBuffers(e={}){if(C(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new Cr(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:Vr;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),o.g.group(Hr,`>>> DRAWING MODEL ${this.id}`,{collapsed:o.g.level<=2})(),e}_logDrawCallEnd(e,t,r,n){if(void 0===e)return;const i=function({vertexArray:e,header:t="Attributes"}={}){if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=vr(e,e.elements,null,t));const n=e.values;for(const i in n){const s=e._getAttributeInfo(i);if(s){let a=`${i}: ${s.name}`;const o=e.accessors[s.location];o&&(a=`${i}: ${Br(s.name,o)}`),r[a]=vr(e,n[i],o,t)}}return r}({vertexArray:t,header:`${this.id} attributes`,attributes:this._attributes}),{table:s,unusedTable:a,unusedCount:u}=Pr({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:c,count:l}=Pr({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});l>0&&o.g.log("MISSING UNIFORMS",Object.keys(c))(),u>0&&o.g.log("UNUSED UNIFORMS",Object.keys(a))();const h=function(e){const t={},r=`Accessors for ${e.id}`;for(const n of e.attributeInfos)n&&(t[`in ${xr(n)}`]={[r]:JSON.stringify(n.accessor)});for(const n of e.varyingInfos)n&&(t[`out ${xr(n)}`]={[r]:JSON.stringify(n.accessor)});return t}(this.vertexArray.configuration);o.g.table(e,i)(),o.g.table(e,s)(),o.g.table(e+1,h)(),n&&n.log({logLevel:Hr,message:`Rendered to ${n.id}`}),o.g.groupEnd(Hr,`>>> DRAWING MODEL ${this.id}`)()}}const zr="void main() {gl_FragColor = vec4(0);}",$r="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",Kr=`#version 300 es\n${$r}`;function Yr(e,t){t=Array.isArray(t)?t:[t];const r=e.replace(/^\s+/,"").split(/\s+/),[n,i,s]=r;return t.includes(n)&&i&&s?{qualifier:n,type:i,name:s.split(";")[0]}:null}function Zr({version:e=100,input:t,inputType:r,output:n}={}){if(!t)return 300===e?Kr:e>300?`#version ${e}\n${$r}`:zr;const i=function(e,t){switch(t){case"float":return`vec4(${e}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${e}, 0.0, 1.0)`;case"vec3":return`vec4(${e}, 1.0)`;case"vec4":return e;default:return ke(!1),null}}(t,r);return e>=300?`#version ${e} ${300===e?"es":""}\nin ${r} ${t};\nout vec4 ${n};\nvoid main() {\n  ${n} = ${i};\n}`:`varying ${r} ${t};\nvoid main() {\n  gl_FragColor = ${i};\n}`}class Qr{constructor(e,t={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(e={}){const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(e={}){const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof z?r:r.buffer:null}getData({varyingName:e}={}){const t=this.getBuffer(e);return t?t.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&R(Object(o.f)(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const e in this.feedbackMap){const n=this.feedbackMap[e];e in t&&(r[n]=e)}Object.assign(r,e.feedbackBuffers);for(const e in r){const n=r[e];if("string"==typeof n){const i=t[n],{byteLength:s,usage:a,accessor:o}=i;r[e]=this._createNewBuffer(e,{byteLength:s,usage:a,accessor:o})}}return r}_setupBuffers(e={}){const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,{model:t}){const{program:r}=t;e.transformFeedback=new Cr(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:t}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:e,feedbackBuffers:t})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const i=this.feedbackMap[n];t[n]=e.feedbackBuffers[i],r[i]=e.sourceBuffers[n],R(r[i]instanceof z)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new z(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}function qr(e){let t=100;const r=e.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){const e=parseInt(r[1],10);Number.isFinite(e)&&(t=e)}return t}var Jr={name:"transform",vs:"attribute float transform_elementID;\n\n// returns half of pixel size, used to move the pixel position to center of the pixel.\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\n// returns current elements pixel indeces [x, y],\n// where x ranges in [0 to texSize-1] and y ranges in [0 to texSize-1]\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  // Add safe offset (half of pixel height) before doing floor\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\n\n// returns current elementID's texture co-ordianate\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\n\n// returns current elementID's position\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  // Change from [0 1] range to [-1 1]\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\n\n// returns current elementID's pixel value\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};const en="transform_uSampler_",tn="transform_uSize_",rn="transform_position";function nn({vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:n}){let i=Object.keys(t).length,s=null;const a={};let o=e,u={};if(i>0||r){const e=o.split("\n"),c=e.slice();if(e.forEach((e,n,o)=>{if(i>0){const r=function(e,t){const r={},n=function(e){return Yr(e,["attribute","in"])}(e);if(!n)return null;const{type:i,name:s}=n;if(s&&t[s]){const t=`// ${e} => Replaced by Transform with a sampler`,{samplerName:n,sizeName:a,uniformDeclerations:o}=function(e){const t=`${en}${e}`,r=`${tn}${e}`;return{samplerName:t,sizeName:r,uniformDeclerations:`  uniform sampler2D ${t};\n  uniform vec2 ${r};`}}(s),u=function(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ke(!1),null}}(i),c=`  ${i} ${s} = transform_getInput(${n}, ${a}).${u};\n`;r[n]=s;const l={"vs:#decl":o,"vs:#main-start":c};return{updatedLine:t,inject:l,samplerTextureMap:r}}return null}(e,t);if(r){const{updatedLine:e,inject:t}=r;c[n]=e,u=Tt([u,t]),Object.assign(a,r.samplerTextureMap),i--}}r&&!s&&(s=function(e,t){const r=Yr(e,["varying","out"]);if(!r)return null;return r.name===t?r.type:null}(e,r))}),r){R(n);const e=`${tn}${r}`;u=Tt([u,{"vs:#decl":`uniform vec2 ${e};\n`,"vs:#main-start":`     vec2 ${rn} = transform_getPos(${e});\n     gl_Position = vec4(${rn}, 0, 1.);\n`}])}o=c.join("\n")}return{vs:o,targetTextureType:s,inject:u,samplerTextureMap:a}}const sn={[s.a.TEXTURE_MIN_FILTER]:s.a.NEAREST,[s.a.TEXTURE_MAG_FILTER]:s.a.NEAREST,[s.a.TEXTURE_WRAP_S]:s.a.CLAMP_TO_EDGE,[s.a.TEXTURE_WRAP_T]:s.a.CLAMP_TO_EDGE},an="transform_output";class on{constructor(e,t={}){this.gl=e,this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(e={}){const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(e={}){const{sourceBuffers:t,sourceTextures:r,framebuffer:n,targetTexture:i}=this.bindings[this.currentIndex],s=Object.assign({},t,e.attributes),a=Object.assign({},e.uniforms),o=Object.assign({},e.parameters);let u=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){s.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const t=this.samplerTextureMap[e];a[e]=r[t]}this._setSourceTextureParameters();const e=function({sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}){const n={};let i,s;t&&(({width:i,height:s}=r),n[`${tn}${t}`]=[i,s]);for(const t in e)({width:i,height:s}=e[t]),n[`${tn}${t}`]=[i,s];return n}({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i});Object.assign(a,e)}return this.hasTargetTexture&&(u=!1,o.viewport=[0,0,n.width,n.height]),{attributes:s,framebuffer:n,uniforms:a,discard:u,parameters:o}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:t}=this.bindings[this.currentIndex],r=ge(t);if(!e)return r;const n=r.constructor,i=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ke(!1),null}}(this.targetTextureType),s=new n(r.length*i/4);let a=0;for(let e=0;e<r.length;e+=4)for(let t=0;t<i;t++)s[a++]=r[e+t];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof ee)return r;const n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(e={}){const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:n}=e,i=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:i}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if("number"!=typeof e||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((e,t,r)=>{r[t]=t}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new z(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:e,targetTexture:t}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:e,targetTexture:t})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:n,targetTexture:i}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),i){e.targetTexture=i;const{width:t,height:r}=i,{framebuffer:n}=e;n?(n.update({attachments:{[s.a.COLOR_ATTACHMENT0]:i},resizeAttachments:!1}),n.resize({width:t,height:r})):e.framebuffer=new pe(this.gl,{id:`${this.id||"transform"}-framebuffer`,width:t,height:r,attachments:{[s.a.COLOR_ATTACHMENT0]:i}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const e in t)t[e].setParameters(sn)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);return t[this._swapTexture]=e.targetTexture,{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}_createNewTexture(e){const t=function(e,t){R(e instanceof ee||e instanceof de||e instanceof Te);const r=e.constructor,{gl:n,width:i,height:s,format:a,type:o,dataFormat:u,border:c,mipmaps:l}=e;return new r(n,Object.assign({width:i,height:s,format:a,type:o,dataFormat:u,border:c,mipmaps:l},t))}(e,{parameters:{[s.a.TEXTURE_MIN_FILTER]:s.a.NEAREST,[s.a.TEXTURE_MAG_FILTER]:s.a.NEAREST,[s.a.TEXTURE_WRAP_S]:s.a.CLAMP_TO_EDGE,[s.a.TEXTURE_WRAP_T]:s.a.CLAMP_TO_EDGE},pixelStore:{[s.a.UNPACK_FLIP_Y_WEBGL]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:i,targetTextureType:s,inject:a,samplerTextureMap:o}=nn({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),u=Tt([e.inject||{},a]);return this.targetTextureType=s,this.samplerTextureMap=o,{vs:n,fs:e._fs||Zr({version:qr(n),input:this.targetTextureVarying,inputType:s,output:an}),modules:this.hasSourceTextures||this.targetTextureVarying?[Jr].concat(e.modules||[]):e.modules,uniforms:i,inject:u}}}class un{static isSupported(e){return Object(o.f)(e)}constructor(e,t={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(e={}){const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();R(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const t=r.getData(e);if(t)return t}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(e={}){const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Wr(t,Object.assign({},e,{fs:e.fs||Zr({version:qr(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||s.a.POINTS,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of r)t=e.updateModelProps(t);return t}_buildResourceTransforms(e,t){(function(e){if(!C(e.feedbackBuffers)||!C(e.feedbackMap)||e.varyings&&e.varyings.length>0)return!0;return!1})(t)&&(this.bufferTransform=new Qr(e,t)),function(e){if(!C(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)return!0;return!1}(t)&&(this.textureTransform=new on(e,t)),R(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of r)t=Object.assign(t,e.getDrawOptions(t));return t}}const cn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ln{static get DRAW_MODE(){return cn}constructor(e={}){const{id:t=L("geometry"),drawMode:r=cn.TRIANGLES,attributes:n={},indices:i=null,vertexCount:s=null}=e;this.id=t,this.drawMode=0|r,this.attributes={},this.userData={},this._setAttributes(n,i),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const t in e){let r=e[t];r=ArrayBuffer.isView(r)?{value:r}:r,R(ArrayBuffer.isView(r.value),`${this._print(t)}: must be typed array or object with value as typed array`),"POSITION"!==t&&"positions"!==t||r.size||(r.size=3),"indices"===t?(R(!this.indices),this.indices=r):this.attributes[t]=r}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const t in e){const n=e[t],{value:i,size:s,constant:a}=n;!a&&i&&s>=1&&(r=Math.min(r,i.length/s))}return R(Number.isFinite(r)),r}}const hn={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class fn extends ln{constructor(e={}){const{id:t=L("truncated-code-geometry")}=e,{indices:r,attributes:n}=function(e){const{bottomRadius:t=0,topRadius:r=0,height:n=1,nradial:i=10,nvertical:s=10,verticalAxis:a="y",topCap:o=!1,bottomCap:u=!1}=e,c=(o?2:0)+(u?2:0),l=(i+1)*(s+1+c),h=Math.atan2(t-r,n),f=Math.sin,_=Math.cos,E=Math.PI,d=_(h),T=f(h),A=o?-2:0,g=s+(u?2:0),m=i+1,R=new Uint16Array(i*(s+c)*6),b=hn[a],p=new Float32Array(3*l),N=new Float32Array(3*l),O=new Float32Array(2*l);let I=0,S=0;for(let e=A;e<=g;e++){let a,o=e/s,u=n*o;e<0?(u=0,o=1,a=t):e>s?(u=n,o=1,a=r):a=t+e/s*(r-t),-2!==e&&e!==s+2||(a=0,o=0),u-=n/2;for(let t=0;t<m;t++){const r=f(t*E*2/i),n=_(t*E*2/i);p[I+b[0]]=r*a,p[I+b[1]]=u,p[I+b[2]]=n*a,N[I+b[0]]=e<0||e>s?0:r*d,N[I+b[1]]=e<0?-1:e>s?1:T,N[I+b[2]]=e<0||e>s?0:n*d,O[S+0]=t/i,O[S+1]=o,S+=2,I+=3}}for(let e=0;e<s+c;e++)for(let t=0;t<i;t++){const r=6*(e*i+t);R[r+0]=m*(e+0)+0+t,R[r+1]=m*(e+0)+1+t,R[r+2]=m*(e+1)+1+t,R[r+3]=m*(e+0)+0+t,R[r+4]=m*(e+1)+1+t,R[r+5]=m*(e+1)+0+t}return{indices:R,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:N},TEXCOORD_0:{size:2,value:O}}}}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}class _n extends fn{constructor(e={}){const{id:t=L("cone-geometry"),radius:r=1,cap:n=!0}=e;super({...e,id:t,topRadius:0,topCap:Boolean(n),bottomCap:Boolean(n),bottomRadius:r})}}const En=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),dn=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Tn=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),An=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),gn={POSITION:{size:3,value:new Float32Array(dn)},NORMAL:{size:3,value:new Float32Array(Tn)},TEXCOORD_0:{size:2,value:new Float32Array(An)}};class mn extends ln{constructor(e={}){const{id:t=L("cube-geometry")}=e;super({...e,id:t,indices:{size:1,value:new Uint16Array(En)},attributes:{...gn,...e.attributes}})}}class Rn extends fn{constructor(e={}){const{id:t=L("cylinder-geometry"),radius:r=1}=e;super({...e,id:t,bottomRadius:r,topRadius:r})}}var bn=r(34);const pn=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],Nn=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];class On extends ln{constructor(e={}){const{id:t=L("ico-sphere-geometry")}=e,{indices:r,attributes:n}=function(e){const{iterations:t=0}=e,r=Math.PI,n=2*r,i=[...pn];let s=[...Nn];i.push(),s.push();const a=(()=>{const e={};return(t,r)=>{const n=(t*=3)<(r*=3)?t:r,s=t>r?t:r,a=`${n}|${s}`;if(a in e)return e[a];const o=i[t],u=i[t+1],c=i[t+2],l=i[r],h=i[r+1],f=i[r+2];let _=(o+l)/2,E=(u+h)/2,d=(c+f)/2;const T=Math.sqrt(_*_+E*E+d*d);return _/=T,E/=T,d/=T,i.push(_,E,d),e[a]=i.length/3-1}})();for(let e=0;e<t;e++){const e=[];for(let t=0;t<s.length;t+=3){const r=a(s[t+0],s[t+1]),n=a(s[t+1],s[t+2]),i=a(s[t+2],s[t+0]);e.push(i,s[t+0],r,r,s[t+1],n,n,s[t+2],i,r,n,i)}s=e}const o=new Array(i.length),u=new Array(i.length/3*2);for(let e=s.length-3;e>=0;e-=3){const t=s[e+0],a=s[e+1],c=s[e+2],l=3*t,h=3*a,f=3*c,_=2*t,E=2*a,d=2*c,T=i[l+0],A=i[l+1],g=i[l+2],m=Math.acos(g/Math.sqrt(T*T+A*A+g*g)),R=Math.atan2(A,T)+r,b=m/r,p=1-R/n,N=i[h+0],O=i[h+1],I=i[h+2],S=Math.acos(I/Math.sqrt(N*N+O*O+I*I)),F=Math.atan2(O,N)+r,L=S/r,y=1-F/n,C=i[f+0],M=i[f+1],v=i[f+2],B=Math.acos(v/Math.sqrt(C*C+M*M+v*v)),P=Math.atan2(M,C)+r,D=B/r,x=1-P/n,U=[C-N,M-O,v-I],w=[T-N,A-O,g-I],G=new bn.a(U).cross(w).normalize();let H;(0===p||0===y||0===x)&&(0===p||p>.5)&&(0===y||y>.5)&&(0===x||x>.5)&&(i.push(i[l+0],i[l+1],i[l+2]),H=i.length/3-1,s.push(H),u[2*H+0]=1,u[2*H+1]=b,o[3*H+0]=G.x,o[3*H+1]=G.y,o[3*H+2]=G.z,i.push(i[h+0],i[h+1],i[h+2]),H=i.length/3-1,s.push(H),u[2*H+0]=1,u[2*H+1]=L,o[3*H+0]=G.x,o[3*H+1]=G.y,o[3*H+2]=G.z,i.push(i[f+0],i[f+1],i[f+2]),H=i.length/3-1,s.push(H),u[2*H+0]=1,u[2*H+1]=D,o[3*H+0]=G.x,o[3*H+1]=G.y,o[3*H+2]=G.z),o[l+0]=o[h+0]=o[f+0]=G.x,o[l+1]=o[h+1]=o[f+1]=G.y,o[l+2]=o[h+2]=o[f+2]=G.z,u[_+0]=p,u[_+1]=b,u[E+0]=y,u[E+1]=L,u[d+0]=x,u[d+1]=D}return{indices:{size:1,value:new Uint16Array(s)},attributes:{POSITION:{size:3,value:new Float32Array(i)},NORMAL:{size:3,value:new Float32Array(o)},TEXCOORD_0:{size:2,value:new Float32Array(u)}}}}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}class In extends ln{constructor(e={}){const{id:t=L("plane-geometry")}=e,{indices:r,attributes:n}=function(e){const{type:t="x,y",offset:r=0,flipCull:n=!1,unpack:i=!1}=e,s=t.split(",");let a=e[`${s[0]}len`]||1;const o=e[`${s[1]}len`]||1,u=e[`n${s[0]}`]||1,c=e[`n${s[1]}`]||1,l=(u+1)*(c+1),h=new Float32Array(3*l),f=new Float32Array(3*l),_=new Float32Array(2*l);n&&(a=-a);let E=0,d=0;for(let e=0;e<=c;e++)for(let i=0;i<=u;i++){const s=i/u,l=e/c;switch(_[E+0]=n?1-s:s,_[E+1]=l,t){case"x,y":h[d+0]=a*s-.5*a,h[d+1]=o*l-.5*o,h[d+2]=r,f[d+0]=0,f[d+1]=0,f[d+2]=n?1:-1;break;case"x,z":h[d+0]=a*s-.5*a,h[d+1]=r,h[d+2]=o*l-.5*o,f[d+0]=0,f[d+1]=n?1:-1,f[d+2]=0;break;case"y,z":h[d+0]=r,h[d+1]=a*s-.5*a,h[d+2]=o*l-.5*o,f[d+0]=n?1:-1,f[d+1]=0,f[d+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}E+=2,d+=3}const T=u+1,A=new Uint16Array(u*c*6);for(let e=0;e<c;e++)for(let t=0;t<u;t++){const r=6*(e*u+t);A[r+0]=(e+0)*T+t,A[r+1]=(e+1)*T+t,A[r+2]=(e+0)*T+t+1,A[r+3]=(e+1)*T+t,A[r+4]=(e+1)*T+t+1,A[r+5]=(e+0)*T+t+1}const g={indices:{size:1,value:A},attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:f},TEXCOORD_0:{size:2,value:_}}};return i?function(e){const{indices:t,attributes:r}=e;if(!t)return e;const n=t.value.length,i={};for(const e in r){const s=r[e],{constant:a,value:o,size:u}=s;if(a||!u)continue;const c=new o.constructor(n*u);for(let e=0;e<n;++e){const r=t.value[e];for(let t=0;t<u;t++)c[e*u+t]=o[r*u+t]}i[e]={size:u,value:c}}return{attributes:Object.assign({},r,i)}}(g):g}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}class Sn extends ln{constructor(e={}){const{id:t=L("sphere-geometry")}=e,{indices:r,attributes:n}=function(e){const{nlat:t=10,nlong:r=10}=e;let{radius:n=1}=e;const i=Math.PI-0,s=2*Math.PI-0,a=(t+1)*(r+1);if("number"==typeof n){const e=n;n=(t,r,n,i,s)=>e}const o=new Float32Array(3*a),u=new Float32Array(3*a),c=new Float32Array(2*a),l=new(a>65535?Uint32Array:Uint16Array)(t*r*6);for(let e=0;e<=t;e++)for(let a=0;a<=r;a++){const l=a/r,h=e/t,f=a+e*(r+1),_=2*f,E=3*f,d=s*l,T=i*h,A=Math.sin(d),g=Math.cos(d),m=Math.sin(T),R=Math.cos(T),b=g*m,p=R,N=A*m,O=n(b,p,N,l,h);o[E+0]=O*b,o[E+1]=O*p,o[E+2]=O*N,u[E+0]=b,u[E+1]=p,u[E+2]=N,c[_+0]=l,c[_+1]=1-h}const h=r+1;for(let e=0;e<r;e++)for(let r=0;r<t;r++){const n=6*(e*t+r);l[n+0]=r*h+e,l[n+1]=r*h+e+1,l[n+2]=(r+1)*h+e,l[n+3]=(r+1)*h+e,l[n+4]=r*h+e+1,l[n+5]=(r+1)*h+e+1}return{indices:{size:1,value:l},attributes:{POSITION:{size:3,value:o},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:c}}}}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}let Fn=1,Ln=1;class yn{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:i=1}=e,s=Fn++,a={time:0,delay:t,duration:r,rate:n,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const e of t)this._setChannelTime(e,this.time);const r=this.animations.values();for(const e of r){const{animation:t,channel:r}=e;t.setTime(this.getTime(r))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=Ln++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay;r>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}class Cn{constructor(e){this._lastTime=-1,this.startIndex=-1,this.endIndex=-1,this.factor=0,this.times=[],this.values=[],this.setKeyFrames(e),this.setTime(0)}setKeyFrames(e){const t=e.length;this.times.length=t,this.values.length=t;for(let r=0;r<t;++r)this.times[r]=e[r][0],this.values[r]=e[r][1];this._calculateKeys(this._lastTime)}setTime(e){(e=Math.max(0,e))!==this._lastTime&&(this._calculateKeys(e),this._lastTime=e)}getStartTime(){return this.times[this.startIndex]}getEndTime(){return this.times[this.endIndex]}getStartData(){return this.values[this.startIndex]}getEndData(){return this.values[this.endIndex]}_calculateKeys(e){let t=0;const r=this.times.length;for(t=0;t<r-2&&!(this.times[t+1]>e);++t);this.startIndex=t,this.endIndex=t+1;const n=this.times[this.startIndex],i=this.times[this.endIndex];this.factor=Math.min(Math.max(0,(e-n)/(i-n)),1)}}const Mn="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",vn=[-1,-1,1,-1,-1,1,1,1];class Bn extends Wr{constructor(e,t){const r=vn.map(e=>-1===e?0:e);super(e,Object.assign({},t,{vs:Mn,geometry:new ln({drawMode:s.a.TRIANGLE_STRIP,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(vn)},aTexCoord:{size:2,value:new Float32Array(r)},aCoordinate:{size:2,value:new Float32Array(r)}}})})),this.setVertexCount(4)}}r.d(t,"AnimationLoop",function(){return He}),r.d(t,"Model",function(){return Wr}),r.d(t,"ProgramManager",function(){return gr}),r.d(t,"Transform",function(){return un}),r.d(t,"Geometry",function(){return ln}),r.d(t,"ConeGeometry",function(){return _n}),r.d(t,"CubeGeometry",function(){return mn}),r.d(t,"CylinderGeometry",function(){return Rn}),r.d(t,"IcoSphereGeometry",function(){return On}),r.d(t,"PlaneGeometry",function(){return In}),r.d(t,"SphereGeometry",function(){return Sn}),r.d(t,"TruncatedConeGeometry",function(){return fn}),r.d(t,"Timeline",function(){return yn}),r.d(t,"KeyFrames",function(){return Cn}),r.d(t,"ClipSpace",function(){return Bn})}])});