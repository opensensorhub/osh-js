<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Data synchronization algorithm | OpenSensorHub Web Client Toolkit</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Data synchronization algorithm | OpenSensorHub Web Client Toolkit"><meta data-react-helmet="true" name="description" content="The main role of the DataSynchronizer is to synchronize multiple data sources based on timestamps."><meta data-react-helmet="true" property="og:description" content="The main role of the DataSynchronizer is to synchronize multiple data sources based on timestamps."><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/advanced/datasynchronizer"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/advanced/datasynchronizer"><link rel="stylesheet" href="/styles.0d5d047b.css">
<link rel="preload" href="/styles.f49bdce4.js" as="script">
<link rel="preload" href="/runtime~main.4789f30b.js" as="script">
<link rel="preload" href="/main.5a94cde1.js" as="script">
<link rel="preload" href="/1.01c8b748.js" as="script">
<link rel="preload" href="/2.68c694de.js" as="script">
<link rel="preload" href="/3.acfdac64.js" as="script">
<link rel="preload" href="/1be78505.d43e909c.js" as="script">
<link rel="preload" href="/73.569dc4e6.js" as="script">
<link rel="preload" href="/935f2afb.694ad386.js" as="script">
<link rel="preload" href="/17896441.f7975bc8.js" as="script">
<link rel="preload" href="/abffd77c.6773be97.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/OSH-Logo-min.svg" alt=""><strong class="navbar__title"></strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://opensensorhub.org/blog/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/opensensorhub/osh-js" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="http://opensensorhub.github.io/osh-js/v2.0.0/showcase/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Samples</a><a href="http://opensensorhub.github.io/osh-js/v2.0.0/documentation/jsdoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/OSH-Logo-min.svg" alt=""><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://opensensorhub.org/blog/" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/opensensorhub/osh-js" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="http://opensensorhub.github.io/osh-js/v2.0.0/showcase/" target="_blank" rel="noopener noreferrer" class="menu__link">Samples</a></li><li class="menu__list-item"><a href="http://opensensorhub.github.io/osh-js/v2.0.0/documentation/jsdoc" target="_blank" rel="noopener noreferrer" class="menu__link">API</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">OpenSensorHub Toolkit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/server">Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/projects">Projects</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting_started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting_started/integration">Integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting_started/usage">Usage</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DataSources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/index">General</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SOS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sos/index">General</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sos/swejson">SweJson</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sos/video">Video</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sos/videoroll">VideoWithRoll</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SPS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sps/datasink">DataSink</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sps/ptz">PTZ Tasking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasources/sps/foscam">Foscam Tasking</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DataSynchronizer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datasynchronizer/index">General</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Views</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/index">General</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Map</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/map/index">General</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/map/ol">OpenLayers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/map/leaflet">Leaflet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/map/cesium">Cesium</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Video</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/video/ffmpeg">FFMPEG</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/video/mjpeg">Mjpeg</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Stylers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/stylers/styler">General</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/chart">Chart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/entity/entity">Entity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/spectrogram">Spectrogram</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Ext</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/ext/index">General</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/ext/rangeslider">Range slider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views/ext/tasking">Tasking</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Vue.js components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/vuejs/index">General</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/vuejs/control">Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/vuejs/menusettings">Menu Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/vuejs/videocontrol">Video Control</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/comchannels">Communication channels</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/advanced/datasynchronizer">Synchronization</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Developers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/advanced/developers/datasourcesdev">New DataSources</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Data synchronization algorithm</h1></header><div class="markdown"><p>The main role of the DataSynchronizer is to synchronize multiple data sources based on timestamps.</p><p>It supports optional <em>buffering</em> (adds latency but sometimes needed, e.g. video) to smooth out the data rate and send events at beginning and end of buffering so UI can display progress.</p><p>It supports <em>timeout</em> if a data source hangs or its latency increases beyond a certain threshold (timeout means we donâ€™t try to sync this data source anymore because it slows down everything else too much and flag data records that are passed the timeout so that views can indicate that the data source is out of sync).</p><p>Finally, it is possible to have multiple dataSynchronizer in the same application, each dataSynchronizer would handle a different group of data sources that we want to synchronize together.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="recall-the-principle-of-the-main-algorithm"></a>Recall the principle of the main algorithm:<a aria-hidden="true" tabindex="-1" class="hash-link" href="#recall-the-principle-of-the-main-algorithm" title="Direct link to heading">#</a></h2><ul><li>Data records from each DS are received in a separate queue (records are added at the end of the queue)</li><li>The DataSynchronizer loop is run with a setInterval() at a frequency that can be adjusted between 5 and 1000ms</li><li>The reference time stamp (TSref) is the timestamp of the first data received from any DS.</li><li>The reference clock time is computed with performance.now() when the first data is outputted by the synchronizer (i.e. at the end of the initial buffering period).</li><li>In each synchronizer loop, we loop through each DS and evaluate the oldest record received from it (i.e. the record at the front of the queue, if any):</li><li>We compare the ğœŸTS of this oldest record (diff between the DS record timestamp and TSref) to the ğœŸclock (diff between current performance.now() and the reference clock time). If ğœŸclock &gt; ğœŸTS, the head of this DS queue can be dispatched</li><li>Continue evaluating the next record from this DS until the condition above returns false</li></ul><p>In addition to the above existing algorithm, the idea is to also do the following:</p><ul><li>Always compute the timestamp of the latest synchronizer loop TSrun = TSref + ğœŸclock</li><li>When we receive a new record from a DS with timestamp TSrec, we compute its latency = min(TSrun - TSrec , DS_timeout) (this is computed when the data is received, not in the main loop, and stored as a variable of the queue object associated with each DS)</li><li>We regularly compute the maximum latency of all DS and compute ğœŸclock_adj  = ğœŸclock - max_latency</li><li>We use ğœŸclock_adj instead of ğœŸclock in the comparison with ğœŸTS in the main loop</li><li>If needed, in order to avoid abrupt changes, we can also smoothout the change of ğœŸclock_adj over time (e.g. over 10 loops)</li><li>In addition, when ğœŸclock_adj - ğœŸTS &gt; threshold we flag the data to indicate that it was received very late and may be processed out of order</li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/advanced/comchannels"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Communication Channels</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/advanced/developers/datasourcesdev"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">New DataSources Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recall-the-principle-of-the-main-algorithm" class="table-of-contents__link">Recall the principle of the main algorithm:</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/styles.f49bdce4.js"></script>
<script src="/runtime~main.4789f30b.js"></script>
<script src="/main.5a94cde1.js"></script>
<script src="/1.01c8b748.js"></script>
<script src="/2.68c694de.js"></script>
<script src="/3.acfdac64.js"></script>
<script src="/1be78505.d43e909c.js"></script>
<script src="/73.569dc4e6.js"></script>
<script src="/935f2afb.694ad386.js"></script>
<script src="/17896441.f7975bc8.js"></script>
<script src="/abffd77c.6773be97.js"></script>
</body>
</html>